---
fr:
  doc_entries:
    sections:
      guide_migration:
        - section: |+
            Ce guide liste l‚Äô**ensemble des changements effectu√©s entre la version 3 de l‚ÄôAPI Entreprise et la version 2**, et vous livre les **√©l√©ments n√©cessaires pour effectuer la migration**.
            Les √©volutions pr√©sent√©es ici ont √©t√© guid√©es par trois objectifs&nbsp;:&nbsp;
            - assurer une meilleure s√©curit√© de la donn√©e des fournisseurs ;
            - normaliser les formats pour faciliter la compr√©hension et l‚Äôindustrialisation ;
            - clarifier, documenter les r√©ponses et les rendre actionnables par vos logiciels.
        - section: |+
            ### 1. JETON D'ACC√àS √Ä PARAM√âTRER DANS LE HEADER

            **üöÄ Avec la V3 :** Le jeton est √† param√©trer uniquement dans le header de l‚Äôappel.
            > Avant : Le jeton JWT pouvait √™tre un param√®tre de l‚ÄôURL d‚Äôappel (query parameter).


            **ü§î Pourquoi ?**
            - Respecter les standards de s√©curit√© ;
            - Garantir que le token ne sera pas utilis√© dans un navigateur.

            **üß∞ Comment ?**
            Utiliser un client REST API pour tester les API pendant le d√©veloppement.
            Des clients sont disponibles gratuitement. API Entreprise utilise pour ses propres tests le client Insomnia. Le plus connu sur le march√© est Postman.
            Une fois le client install√©, vous pouvez directement int√©grer notre fichier Swagger/OpenAPI dedans.
        - section: |+
            ### 2. VOTRE NUM√âRO DE SIRET OBLIGATOIRE DANS LE `RECIPIENT`

            **üöÄ Avec la V3 :** Le param√®tre obligatoire `recipient` de l‚ÄôURL d‚Äôappel devra obligatoirement √™tre compl√©t√© par votre num√©ro de SIRET.
            > Avant : Ce param√®tre obligatoire n‚Äô√©tait pas contraint en termes de syntaxe.

            **ü§î Pourquoi ?**
            - Pour garantir la tra√ßabilit√© de l‚Äôappel jusqu‚Äôau b√©n√©ficiaire ayant obtenu l‚Äôhabilitation √† appeler l‚ÄôAPI Entreprise et respecter nos engagements aupr√®s des fournisseurs de donn√©es ;
            - Nous avions trop d‚Äôutilisateurs inscrivant le num√©ro de SIRET ou RNA de l‚Äôentreprise/association recherch√©e.

            **‚ö†Ô∏è Cas particulier :**
            _Vous √™tes un √©diteur ?_ Ce n‚Äôest pas votre num√©ro de SIRET mais celui de votre client public (qui a effectu√© la demande d‚Äôhabilitation) qu‚Äôil s‚Äôagira de renseigner.

        - section: |+
            ### 3. CODES ERREURS SP√âCIFIQUES √Ä CHAQUE SITUATION, ACTIONNABLES ET DOCUMENT√âS
            **üöÄ Avec la V3 :** Tous les codes erreur HTTPS sont accompagn√©s de codes plus pr√©cis, sp√©cifiques √† chaque situation d‚Äôerreur. Une explication en toutes lettres est √©galement donn√©e dans la payload. Enfin, dans certains cas, une m√©tadonn√©e actionnable est disponible.
            Dans l‚Äôexemple ci-dessous, la cl√© `retry_in` permet de relancer un appel apr√®s le nombre de secondes indiqu√©es.

            ###### Exemple de Payload d‚Äôun code HTTP 502 :
            ```
            {
                "errors": [
                   {
                        "code": "04501",
                        "title": "Analyse de la situation du compte en cours",
                        "detail": "La situation de l'entreprise requiert une
                                   analyse manuelle d'un agent de l'URSSAF.
                                   Une demande d'analyse vient d'√™tre envoy√©e,
                                   cela prend au maximum 2 jours.",
                        "meta": {
                            "provider": "ACOSS",
                            "retry_in": 172800
                        }
                    }
                ]
            }
            ```

            > Avant : Seul le code HTTP standard vous √©tait fourni. Il pouvait correspondre √† de nombreuses situations.
            > ###### Exemple de payload d‚Äôun code HTTP 502 :
            > ```
            > {
            >    "errors": [
            >        "L'ACOSS ne peut r√©pondre √† votre requ√™te, r√©essayez ult√©rieurement  (erreur: Analyse de la situation du compte en cours)"
            >    ]
            > }
            > ```

            **ü§î Pourquoi ?**
            - Pour pr√©ciser la nature de l‚Äôerreur et vous aider √† la comprendre ;
            - Pour vous permettre d‚Äôactionner automatiquement l‚Äôerreur en utilisant le code.


            **üß∞ Comment ?**
            Utiliser les libell√©s pour comprendre l‚Äôerreur rencontr√©e, voire automatiser votre logiciel en fonction du code.
            La [liste de tous les codes erreurs sp√©cifiques (environ 80)](TODO) sera ajout√©e progressivement au Swagger ainsi qu‚Äô√† la documentation technique g√©n√©rale.

        - section: |+
            ### 4. VOLUM√âTRIE INDIQU√âE DANS LE HEADER ET ACTIONNABLE

            La gestion de la volum√©trie est maintenue identique √† la derni√®re √©volution de la V2 et expliqu√©e dans cette [documentation](https://entreprise.api.gouv.fr/doc/#respecter-la-volum√©trie).

        - section: |+
            ### 5. GESTION DES √âVOLUTIONS FUTURES

            **üöÄ Avec la V3 :** Toutes les API pourront √©voluer ind√©pendamment les unes des autres. Les anciennes versions resteront toujours disponibles. Le num√©ro de version devient donc un param√®tre de l‚Äôappel et non plus une valeur fixe pour toutes les API. üì© Une infolettre annoncera syst√©matiquement les nouvelles √©volutions.

            > Avant : L‚Äô√©volution d‚Äôun endpoint exigeait la mont√©e en version de toute l‚ÄôAPI.

            **ü§î Pourquoi ?**
            - Permettre l‚Äôajout de nouvelles informations sans forcer les fournisseurs de service √† monter de version ;
            - Continuer de garantir la continuit√© des API dans le temps.

            **üß∞ Comment ?**
            Renseigner directement le num√©ro de la version voulue dans l‚ÄôURL, au m√™me endroit qu‚Äôavant, par exemple :
            `https://entreprise.api.gouv.fr/v3/insee/sirene/etablissements/:siret`


        - section: |+
            ### 6. UN SEUL FOURNISSEUR ET UN SEUL TYPE DE DONN√âES PAR API

            **üöÄ Avec la V3 :** Chaque API appelle un seul et unique fournisseur de donn√©es.
            Il n‚Äôexiste plus d‚ÄôAPI √† contenu multiple, comme celui de l‚ÄôINSEE, leurs informations ont √©t√© d√©coup√©es en plusieurs API.

            > Avant : Certaines API appelaient deux fournisseurs √† la fois. Certaines API regroupaient de tr√®s nombreuses informations diff√©rentes.

            ###### Exemple :
            L‚ÄôAPI V2 ‚ÄúDonn√©es de r√©f√©rence d'un √©tablissement - `/etablissements`‚Äù est coup√©e en 2 API dans la V3 :
            - Donn√©e de r√©f√©rence d'un √©tablissement [diffusible](https://v3-beta.entreprise.api.gouv.fr/endpoints/insee/etablissements_diffusibles) ou [tous les √©tablissements y compris les non-diffibles](https://v3-beta.entreprise.api.gouv.fr/endpoints/insee/etablissements) (Fournisseur : INSEE) ;
            - Les mandataires sociaux (Fournisseur&nbsp;:&nbsp;Infogreffe).

            L'API V3 vous permet √©galement de retrouver directement les donn√©es d'un √©tablissement si√®ge, √† partir du Siren d'une unit√© l√©gale, avec l'[API Si√®ge social](https://v3-beta.entreprise.api.gouv.fr/endpoints/insee/siege_social).

            **ü§î Pourquoi ?**
            - Acc√©l√©rer le temps de r√©ponse des API, car il y a moins d‚Äôappels externes ;
            - R√©duire le nombre d‚Äôerreurs car le p√©rim√®tre de la donn√©e disponible est plus explicite ;
            - Faciliter la compr√©hension m√©tier des donn√©es transmises.

            **üß∞ Comment ?**
            Utiliser la [table de correspondance](#table-correspondance) pour identifier les nouvelles API.

        - section: |+
            ### 7. LES PAYLOADS DE R√âPONSES NORMALIS√âES ET ENRICHIES

            **üöÄ Avec la V3 :** La payload de r√©ponse est enrichie de m√©tadonn√©es actionnables, inscrites dans les cl√©s `links` et `meta`. Son format est √©galement normalis√© √† l‚Äôaide de la convention JSON API, avec l‚Äôajout d‚Äôun identifiant et d‚Äôune description de la donn√©e renvoy√©e en d√©but de payload.

            Les cl√©s `links` renvoient des URL d‚Äôappel pr√™tes √† l‚Äôemploi permettant d‚Äôobtenir des informations suppl√©mentaires. Par exemple, dans l‚ÄôAPI renvoyant les donn√©es sur une entit√© l√©gale, un lien est ajout√© pour appeler l‚ÄôAPI du si√®ge social.

            ###### Architecture de la payload V3 :
            ```
            {
            ‚Äúdata‚Äù : {
                       id‚Äù : ‚Äú...................‚Äù
                ‚Äútype‚Äù : ‚Äú...............‚Äù,
                ‚Äúattributes‚Äù : {
                    LES DONN√âES  },
                ‚Äúlinks‚Äù :  {
                    ‚Ä¶ },
                ‚Äúmeta‚Äù : {
                    ‚Ä¶ }
            }
            }
            ```

            > Avant : La structure de la payload n‚Äô√©tait pas normalis√©e ni conventionn√©e ; elle ne contenait aucune information  explicitant la nature de la r√©ponse. Les liens permettant d‚Äôappeler une autre API n‚Äô√©taient pas disponibles.
            > ###### Architecture de la payload V2 :
            > ```
            > {
            >     LES DONN√âES,
            > }
            > ```


            **ü§î Pourquoi ?**
            - Uniformiser toutes les payloads de r√©ponses ;
            - Permettre la connexion entre les API gr√¢ce √† l‚Äôajout des liens URL.


            ### TABLE DE CORRESPONDANCE V.2 > V.3 <a name="table-correspondance"></a>

            Cette partie du guide de migration permet de trouver la correspondance de chaque API de la v2 avec les API de la V3&nbsp;:&nbsp;

            **Sommaire des tables de correspondance des API v2 :**
              * ["Donn√©es de r√©f√©rence d'une entit√©" - INSEE](#v2/entreprises)
              * ["Donn√©es de r√©f√©rence d'un √©tablissement" - INSEE](#v2/etablissements)
              * ["Extrait RCS" - Infogreffe](#v2/extrait_rcs)
              * ["Informations d√©claratives d‚Äôune association" - Minist√®re de l'Int√©rieur](#v2/associations)
              * ["Divers documents d'une association" - Minist√®re de l'Int√©rieur](#v2/doc-associations)
              * ["Actes" - INPI](#v2/actes)
              * ["Conventions colectives" - Fabrique num√©rique des Minist√®res sociaux](#v2/conventions-collectives)
              * ["Donn√©es de r√©f√©ence d'une entreprise artisanale" - CMA France](#v2/entreprises-artisanales)
              * ["Effectifs d'uneentreprise" - URSSAF](#v2/effectifs)
              * ["Immatriculation EORI" - Douanes](#v2/eori)
              * ["Chiffre d'affaies" - DGFIP](#v2/exercices)
              * ["Bilans annuels"- INPI](#v2/bilans-inpi)
              * ["3 derniers bilas annuels" - Banque de France](#v2/bilans-bdf)
              * ["D√©clarations der√©sulats" - DGFIP](#v2/liasses-fiscales)
              * ["Attestation fisale" - DGFIP](#v2/attestation-fiscale)
              * ["Attestation de igilance" - ACOSS](#v2/attestation-vigilance)
              * ["Conformit√© empli des travailleurs handicap√©s" - Agefiph](#v2/conformite-emploi-handicapes)
              * ["Cotisations de √©curit√© agricole" - MSA](#v2/cotis-secu-agricole)
              * ["Cotisations retaite b√¢timent" - PROBTP](#v2/cotis-retraite-batiment)
              * ["Carte professionelle travaux publics" - FNTP](#v2/carte-pro-travaux-publics)
              * ["Cotisations con√©s pay√©s & ch√¥mage intemp√©ries" - CNETP](#v2/cotis-conges-payes-chomage-intemperies)
              * ["Certification e BIO" - Agence BIO](#v2/certif-bio)
              * ["Certification RE" - ADEME](#v2/rge-ademe)
              * ["Certification d qualification du b√¢timent" - Qualibat](#v2/qualibat)
              * ["Certification d qualification d'ing√©nierie" - OPQIBI](#v2/certif-opqibi)
              * ["Brevets, mod√®le et marques d√©pos√©s" - INPI](#v2/brevet-modeles-marques)


            ### `V2 - Donn√©es de √©f√©rence d'une entit√© - INSEE` <a name="v2/entreprises"></a>

            L'API V2 `/entreprise` de l'INSEE a √©t√© d√©coup√©e en plusieurs API diff√©rentes dans la V3 :
            - les donn√©es de r√©f√©ence de l'unit√© l√©gale tir√©es de l'Insee ;
            - les donn√©es sur le i√®ge social de l'unit√© l√©gale sont s√©par√©es ;
            - les mandataires socaux tir√©s d'Infogreffe font aussi l'objet d'une autre API.

            La distinction entre es diffusibles et les non-diffusibles n'est plus faite par une option d'appel. Nous avons cr√©√© des API distinctes.

      developers:
          - section: |+
              ## Pr√©requis

              Voici la liste des fondamentaux techniques √† mettre en place pour le bon fonctionnement de l‚ÄôAPI Entreprise&nbsp;:&nbsp;

              - ‚úÖ √ätre en mesure de g√©rer le protocole HTTPS ;

              - ‚úÖ Avoir une version de langage r√©cente. Si vous utilisez Java, une version >= 1.8 est n√©cessaire (pour la gestion des certificats de +1024 bit, du TLS 1.2 minimum et des suites cryptographiques - ciphers) ;

              - ‚úÖ S‚Äôassurer que nos Autorit√©s de Certification (AC) pour les certificats SSL sont autoris√©es par vos syst√®mes ;

              - ‚úÖ L'API Entreprise est uniquement accessible par internet. Si vous avez un pare-feu, il faut donc pr√©voir de whitelister l'adresse IP du service API Entreprise ;

              - ‚úÖ Il est interdit d'interroger l'API Entreprise depuis un site web en front-end, car le jeton d'acc√®s serait alors divulgu√©. Il vous faut donc interroger nos API depuis une application en back-end. Nous n'autoriserons pas le CORS (CORS - Cross Origin Ressource Sharing) ;

              - ‚úÖ Pr√©voir non seulement les co√ªts de d√©veloppement mais √©galement les co√ªts de maintenance ;

              - ‚úÖ √ätre en capacit√© de g√©rer les mises √† jour de l'API Entreprise.

          - section: |+
              ## Sp√©cifications g√©n√©rales de l'API Entreprise

              ### Volum√©trie

              #### Limites √† respecter

              Les limites de volum√©trie sur API Entreprise se d√©composent en deux r√®gles principales&nbsp;:&nbsp;

              - Un plafond g√©n√©ral par IP de 1000 requ√™tes/minute.

              - Une volum√©trie par jeton par groupe d‚Äôendpoints&nbsp;:&nbsp;
                - 1er groupe&nbsp;:&nbsp;Les endpoints renvoyant du JSON constituent un premier groupe. Vous pouvez effectuer jusqu‚Äô√† 250 requ√™tes/min/jeton sur ce groupe.
                - 2√®me groupe&nbsp;:&nbsp;Les endpoints transmettant des documents constituent un autre groupe. La volum√©trie maximale d‚Äôappel concernant ce groupe est de 50 requ√™tes/min/jeton.
                - Exceptions&nbsp;:&nbsp;Certains endpoints √©chappent √† cette r√®gle et pr√©sentent une volum√©trie sp√©cifique par endpoint&nbsp;:&nbsp;
                  - L‚Äô[attestation fiscale de la DGFIP](TODO)&nbsp;:&nbsp;5 requ√™tes/min/jeton ;
                  - Les [actes de l‚ÄôINPI](TODO)&nbsp;:&nbsp;5 requ√™tes/min/jeton ;
                  - Les [bilans de l‚ÄôINPI](TODO)&nbsp;:&nbsp;5 requ√™tes/min/jeton ;
                  - Les [effectifs de l‚ÄôURSSAF](TODO)&nbsp;:&nbsp;250 requ√™tes/min/jeton ;
                  - La [conformit√© des travailleurs handicap√©s de l‚ÄôAgefiph](TODO)&nbsp;:&nbsp;250 requ√™tes/min/jeton.

              Pour vous assurer de la volum√©trie d‚Äôun endpoint en particulier, vous pouvez consulter la partie ‚Äúdisponibilit√©‚Äù de sa documentation dans le [catalogue de donn√©es](TODO).

              #### Informations actionnables et alertes

              ##### Header associ√© √† chaque r√©ponse


              | Champs du header    |   Signification    |     Format           |
              |:------------------------------|:------------------|:------------:|
              | `RateLimit-Limit` |La **limite** concernant l'endpoint appel√©, soit le nombre de requ√™te/minute. | Nombre|
              | `RateLimit-Remaining` |Le **nombre d'appels restants** durant la p√©riode courante d'une minute. | Nombre |
              | `RateLimit-Reset` |La **fin de la p√©riode** courante. | Timestamp |

              >**Exemple&nbsp;:**
              >Consid√©rons un endpoint ayant une limite de 50 appels /minute.
              >Vous fa√Ætes un premier appel √† 10h00 pile, et effectuez un second appel 20 secondes plus tard, puis un troisi√®me 10 secondes plus tard, vous aurez les valeurs suivantes :
              > - RateLimit-Limit : 50 ;
              > - RateLimit-Remaining : 47 (50 moins les 3 appels effectu√©s) ;
              > - RateLimit-Reset : [*Timestamp correspondant au jour pr√©sent √† 10h01*]. Le premier appel initialise le compteur (√† 10h00 pile), la p√©riode se termine 1m plus tard.
              >
              > Vous pouvez donc jusqu'√† 10h01 pile effectuer 47 appels, le compteur sera r√©initialis√© √† 50 √† ce moment-l√†.

              ##### Header associ√© √† un code 429

              Si vous d√©passez le nombre d'appels autoris√©s (`RateLimit-Remaining = 0`), le serveur r√©pondra avec le **status 429** sur tous les appels suivants dans la m√™me p√©riode.

              Le header associ√© √† ce code erreur 429 sera accompagn√©&nbsp;:&nbsp;
              - des trois champs pr√©c√©dents ;
              - d'un champ suppl√©mentaire indiquant le temps √† attendre avant de pouvoir effectuer des nouveaux appels.

              | Champs du header    |   Signification    |     Format           |
              |:------------------------------|:------------------|:------------:|
              | `RateLimit-Limit` |La **limite** concernant l'endpoint appel√©, soit le nombre de requ√™te/minute. | Nombre|
              | `RateLimit-Remaining` |Le **nombre d'appels restants** durant la p√©riode courante d'une minute. | Nombre |
              | `RateLimit-Reset` |La **fin de la p√©riode** courante. | Timestamp |
              | *Uniquement pour le header associ√© au code erreur 429* <br> `Retry-after`| **D√©compte du nombre de secondes restantes** avant la prochaine p√©riode | Secondes |

              Vous pouvez donc **utiliser les champs du header pour optimiser votre consommation de l'API Entreprise**.

              #### Bannissement

              En cas de **non prise en compte des codes erreurs 429** ou en cas de **d√©passement de la limite de volum√©trie globale**, votre IP sera temporairement bannie de nos serveurs **pour une dur√©e fixe et non r√©vocable de 12h**. Si vous avez plusieurs jetons, tous seront donc bloqu√©s pendant ce laps de temps.

              Les appels depuis une IP bannie ne renvoient pas de codes HTTP, le serveur ne r√©pond tout simplement pas.
              Vous pouvez en revanche v√©rifier si vous avez d√©pass√© ce seuil depuis votre tableau de bord.

              > ‚ÑπÔ∏è Au bout de ces 12 heures, vos acc√®s sont automatiquement r√©tablis ; **il est donc inutile d'√©crire au support**.

              Nous vous invitons √† prendre les mesures n√©cessaires car le d√©passement intervient g√©n√©ralement chez nos utilisateurs lorsque leur programme n'a pas √©t√© correctement configur√©.

              Pour les appels de traitement de masse, il est souhaitable que vous fassiez vos **batchs automatiques la nuit ou durant les heures creuses** afin de ne pas affecter la qualit√© du service pour le reste des usagers.

              ### Timeout

              Le timeout est le temps d'attente maximal de r√©ponse √† une requ√™te. Pour chaque endpoint, nous vous indiquons le timeout id√©al dans le [catalogue de donn√©e](../catalogue/).

              Le timout est un outil important qui permet de ne pas immobiliser votre logiciel en le laissant bloqu√© sur un appel sans r√©ponse.

              De fa√ßon g√©n√©rale, nous vous recommandons un timeout&nbsp;:&nbsp;
              - de **5 secondes** pour les appels de donn√©es structur√©es JSON ;
              - de **12 secondes** pour les appels retournant un PDF ou un ZIP.

              De m√™me, pour ne pas immobiliser nos serveurs, nous attendons les r√©ponses de nos fournisseurs un maximum de 10 secondes avant de vous les retransmettre. Si ce d√©lai d‚Äôattente est d√©pass√© un code erreur HTTP 504 vous sera renvoy√©.

              ### Certificats SSL

              API Entreprise utilise [DHIMYOTIS](https://www.dhimyotis.com/) comme organisme de d√©livrance de ses certificats SSL principaux ainsi que [Let's Encrypt](https://letsencrypt.org/) pour certains services secondaires.

              Il est conseill√© d'ajouter ces Autorit√©s de Certifications (AC) √† votre base de confiance si vous en avez une. Une solution id√©ale est d'utiliser un paquet d'autorit√©s mises √† jour automatiquement ([Mozilla par exemple](https://wiki.mozilla.org/CA/Included_Certificates))

              API Entreprise utilise des certificats multi-domaines ; c'est √† dire avec un "nom courant" (_common name - CN_) et plusieurs "noms alternatifs du sujet" (_subject alternatives names - SAN_), soyez certains que vos outils fonctionnent correctement avec.

              ### Code HTTPS et gestion des erreurs

              #### Un code standard HTTPS pour cat√©goriser le statut de l'appel
              Toutes les r√©ponse de l‚ÄôAPI Entreprise sont envoy√©es avec un code HTTPS. **Ces codes permettent de se renseigner sur le statut de l‚Äôappel**. Pour en savoir plus sur les codes HTTPS, cet article de [Wikipedia](https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP)constitue une bonne base explicative.

              API Entreprise a harmonis√© les codes erreur de l‚Äôensemble des fournisseurs de donn√©es, en s'appuyant sur le protocole HTTP, afin de vous en simplifier la compr√©hension.

              <details>

                <summary>üëÄ Consulter la liste des codes HTTPS et leur signification.</summary>

                ###### En cas de succ√®s, le code HTTP commence par 2 :

                | Code HTTPS                                       |      Signification                 |
                |--------------------------------------------------|------------------------------------|
                |`200` | **Tout va bien.**|
                |`206` | **R√©ponse incompl√®te** - La requ√™te a fonctionn√© mais un des fournisseurs de donn√©es a renvoy√© une erreur ou une r√©ponse incompl√®te. Les valeurs concern√©es dans le JSON contiennent le message : ‚ÄúDonn√©e indisponible‚Äù.|

                ###### En cas d‚Äô√©chec, si l‚Äôerreur vient de votre c√¥t√©, le code HTTP commence par 4 :

                | Code HTTP                       |      Signification                     |
                |---------------------------------|----------------------------------------|
                |`400` | **Mauvaise requ√™te** ‚Äì La syntaxe de votre requ√™te est erron√©e.|
                |`401` | **Non autoris√©** ‚Äì Votre token est invalide ou manquant.|
                |`403` | **Interdit** ‚Äì Le serveur a compris votre requ√™te mais refuse de l‚Äôex√©cuter car votre jeton ne vous donne pas acc√®s √† cette ressource.|
                |`404` | **Non trouv√©** ‚Äì La ressource (l'entreprise, le certificat, ‚Ä¶) demand√©e n'a pas √©t√© trouv√©e. Cette erreur intervient par exemple lors de l‚Äôentr√©e d‚Äôun num√©ro de SIREN qui n‚Äôexiste pas, ou bien lorsque l‚Äôentreprise qu‚Äôil designe est en dehors du p√©rim√®tre de l‚Äôendpoint.|
                |`422` | **Entit√© non traitable** ‚Äì Le format de la donn√©e pass√©e en param√®tre n'est pas accept√©. Par exemple, si vous entrez 20 chiffres dans le param√®tre SIREN, votre requ√™te est automatiquement rejet√©e, car un SIREN fait obligatoirement 9 chiffres.|
                |`451` | **Indisponible pour raisons l√©gales** - ce code est sp√©cifiquement renvoy√© lorsque vous demandez les informations d‚Äôune entreprise ou d‚Äôun √©tablissement non diffusible au travers des endpoints `entreprises` et `etablissements` de l‚ÄôINSEE, sans avoir utilis√© l‚Äôoption d‚Äôappel sp√©cifique. Pour en savoir plus, [consultez la documentation de cet endpoint dans le catalogue de donn√©es](../catalogue/).|


                ###### En cas d‚Äô√©chec, si l‚Äôerreur provient d‚ÄôAPI Entreprise ou bien des fournisseurs de donn√©es, le code HTTP commence par 5 :

                | Code HTTP                        |      Signification                     |
                |----------------------------------|----------------------------------------|
                |`500` | **Erreur interne √† API Entreprise** ‚Äì Une erreur interne du serveur d‚ÄôAPI Entreprise est survenue. [Consultez votre tableau de bord](https://dashboard.entreprise.api.gouv.fr/login){:target="_blank"}, l‚Äôhistorique de l‚Äôincident devrait y √™tre affich√© ; ainsi que les actions √† venir.
                |`502` | **Erreur interne fournisseur** ‚Äì Une erreur interne du serveur du ou des fournisseurs est survenue. [Consultez votre tableau de bord](https://dashboard.entreprise.api.gouv.fr/login){:target="_blank"}, l‚Äôhistorique de l‚Äôincident devrait y √™tre affich√© ; ainsi que les actions √† venir.
                |`503` | **Service non disponible** ‚Äì Le service est temporairement indisponible ou en maintenance. Pour conna√Ætre l‚Äôhistorique de disponibilit√© et les incidents type de l‚Äôendpoint, vous pouvez [consulter le catalogue de donn√©es](../catalogue/).
                |`504` | **Interm√©diaire hors d√©lai** ‚Äì Le(s) producteur(s) de donn√©es ont mis trop de temps √† r√©pondre. Notre temps d‚Äôattente, nous permettant de ne pas immobiliser le serveur sur un appel sans r√©ponse, est fix√© √† 10 secondes et a √©t√© d√©pass√©.|

                </details>

                #### En V3, un second code sp√©cifique API Entreprise pour pr√©ciser l'erreur et enclencher une action

                Avec la V3, tous les codes erreur HTTPS sont accompagn√©s de codes plus pr√©cis, sp√©cifiques √† chaque situation d‚Äôerreur. Une explication en toutes lettres est √©galement donn√©e dans la payload. Enfin, dans certains cas, une m√©tadonn√©e actionnable est disponible.

                Dans l‚Äôexemple ci-dessous, la cl√© `retry_in` permet justement de relancer un appel apr√®s le nombre de secondes indiqu√©es.

                >_Exemple de payload d'un code HTTPS 502 :_
                >```
                >{
                >    "errors": [
                >       {
                >            "code": "04501",
                >            "title": "Analyse de la situation du compte en cours",
                >            "detail": "La situation de l'entreprise requiert une analyse manuelle d'un agent de l'URSSAF. Une >demande d'analyse vient d'√™tre envoy√©e, cela prend au maximum 2 jours.",
                >            "meta": {
                >                "provider": "ACOSS",
                >                "retry_in": 172800
                >           }
                >        }
                >    ]
                >}
                >```

                ### Param√®tres d'appel et tra√ßabilit√©

                API Entreprise vous permet d‚Äôacc√©der √† des donn√©es prot√©g√©es. C‚Äôest pourquoi, dans un **objectif de tra√ßabilit√©**, nous vous demandons de renseigner dans chacune de vos requ√™tes, **non seulement un jeton d‚Äôacc√®s**, mais aussi certaines informations qualifiant votre requ√™te.


                > ‚ö†Ô∏è **Ces param√®tres sont obligatoires**. Les appels ne comportant pas ces param√®tres sont rejet√©s, et un code erreur vous est renvoy√©.


                Pour chaque endpoint, nous pr√©cisons dans le [catalogue des donn√©es](../catalogue/) les param√®tres obligatoires sp√©cifiques, ci-dessous une explication d√©taill√©e des √©l√©ments √† fournir pour chaque param√®tre de tra√ßabilit√© :

                | Param√®tre                                                  |      Information √† renseigner           |
                |:----------------------------------------------------------:|-----------------------------------------|
                |`&context=CadreDeLaRequ√™te`|**Cadre de la requ√™te** <br>Par exemple : aides publiques, march√©s publics ou gestion d'un r√©f√©rentiel tiers utilis√© pour tel type d'application*.*
                |`&recipient=B√©n√©ficaireDeL'Appel`|**B√©n√©ficiaire de l'appel** <br>SIRET de l'administration destinatrice des donn√©es.
                |`&object= RaisonDeL'AppelOuIdentifiant`|**La raison de l'appel** <br> ou l'identifiant de la proc√©dure. <br> L'identifiant peut √™tre interne √† votre organisation ou bien un num√©ro de march√© publique, un nom de proc√©dure ; l'essentiel est que celui-ci vous permette de tracer et de retrouver les informations relatives √† l'appel. En effet, vous devez pouvoir justifier de la raison d'un appel aupr√®s du fournisseur de donn√©es. Description courte (< 50 caract√®res).

                ### Compatibilit√© ascendante et versionnage

                Avec la V3, toutes les API pourront √©voluer ind√©pendamment les unes des autres. Les anciennes versions resteront toujours disponibles. Le num√©ro de version devient donc un param√®tre de l‚Äôappel et non plus une valeur fixe pour toutes les API.

                Pour changer de version, il suffit de mettre le num√©ro de la version voulue (√† partir de `v3`) dans l‚ÄôURL, au m√™me endroit qu‚Äôavant, par exemple : `https://entreprise.api.gouv.fr/v3/insee/sirene/etablissements/:siret`

                Ce type de versionnage permet&nbsp;:&nbsp;
                - d'ajouter de nouvelles informations sans forcer nos utilisateurs √† monter de version ;
                - de continuer de garantir la continuit√© des API dans le temps.

                > üì© Une techlettre annoncera syst√©matiquement les nouvelles √©volutions. Vous pouvez vous abonner [ici](TODO).


                ### Monitorer la disponibilit√© des API

                #### Disponibilit√© des API en temps r√©el

                Pour conna√Ætre la disponibilit√© de tous les endpoints en temps r√©el, vous pouvez utiliser l'API `/current_status`. Cette **API est ouverte et ne n√©cessite pas de token**, attention √† tout de m√™me respecter les [limites de volum√©trie](TODO) habituelles.

                ###### La requ√™te HTTP :


                ```
                https://entreprise.api.gouv.fr/watchdoge/dashboard/current_status
                ```


                > **Exemple de r√©ponse JSON :**
                >
                >```
                >      {
                >        "results": [
                >          {
                >            "uname": "apie_2_etablissements",
                >            "name": "Etablissements",
                >            "provider": "insee",
                >            "api_version": 2,
                >            "code": 200,
                >            "timestamp": "2020-10-14T14:36:33.640Z"
                >          },
                >          {
                >            "uname": "apie_2_certificats_qualibat",
                >            "name": "Certificats Qualibat",
                >            "provider": "qualibat",
                >            "api_version": 2,
                >            "code": 503,
                >            "timestamp": "2020-10-14T14:38:02.736Z"
                >          },
                >          [...]
                >        ]
                >      }
                >
                > ```

                ‚ÑπÔ∏è Pour plus d'informations, vous pouvez vous r√©f√©rer √† l'[environnement de production document√© (*swagger*) disponible sur api.gouv.fr](https://api.gouv.fr/documentation/api-entreprise).

                #### Historique de disponibilit√© des API

                Pour conna√Ætre l'historique de disponibilit√© des donn√©es de API Entreprise ainsi que le taux d'erreurs constat√©es, vous pouvez utiliser l'API `/provider_availabilities`. **Cette API est ouverte et ne n√©cessite pas de token**, attention √† tout de m√™me respecter les [limites de volum√©trie](TODO) habituelle.

                ###### La requ√™te HTTP :

                ```
                https://entreprise.api.gouv.fr/watchdoge/stats/provider_availabilities?period=Param√®treDeLaPeriode&endpoint=Param√®treDuEndpoint
                ```


                Pour appeler l'API concernant l'endpoint et la p√©riode voulue, r√©f√©rez-vous √† la suite de cet article ‚§µÔ∏è


                > **Exemple de r√©ponse JSON :**
                >```
                >      {
                >        "endpoint": "api/v3/entreprises_restored",
                >        "days_availability": {
                >          "2020-04-13": {
                >            "total": 12615,
                >            "404": 9,
                >            "502": 0,
                >            "503": 0,
                >            "504": 0
                >          },
                >          "2020-04-14": {
                >            "total": 44677,
                >            "404": 25,
                >            "502": 0,
                >            "503": 16,
                >            "504": 0
                >          }
                >        },
                >        "total_availability": 99.96,
                >        "last_week_availability": 100.0
                >      }
                >      ```


                ###### Nomenclature des param√®tres de la requ√™te HTTP :


                Cette API poss√®de deux param√®tres, `period` et `endpoint`, voici leur nomenclature :

                |Liste indicative de *period*|P√©riode correspondante|
                |---|---|
                |`1y` | depuis un an |
                |`2M` | depuis 2 mois |
                |`3w` | depuis 3 semaines |
                |`4d` | depuis 4 jours |
                |`5h` | depuis 5 heures |
                |`6m` | depuis 6 minutes |
                |`7s` | depuis 7 secondes |

                √Ä partir de la nomenclature, `Y`(ann√©e), `M`(mois), `W`(semaine), `D`(jour), `m`(minute), `s`(seconde), vous pouvez obtenir l'historique de disponibilit√© de la p√©riode que vous souhaitez.

                |Liste exhaustive des *endpoint*|API correspondante|
                |---|---|
                |`api/v3/entreprises_restored`|[Entreprises](https://entreprise.api.gouv.fr/catalogue/#entreprises)|
                |`api/v3/etablissements_restored`|[√âtablissements](https://entreprise.api.gouv.fr/catalogue/#etablissements)|
                |`api/v2/extraits_rcs_infogreffe`|[Extrait RCS](https://entreprise.api.gouv.fr/catalogue/#extraits_rcs_infogreffe)|
                |`api/v2/associations`|[Informations d√©claratives d‚Äôune association](https://entreprise.api.gouv.fr/catalogue/#associations)|
                |`api/v2/documents_associations`|[Divers documents d'une association](https://entreprise.api.gouv.fr/catalogue/#documents_associations)|
                |`api/v2/documents_inpi`|[Actes INPI](https://entreprise.api.gouv.fr/catalogue/#actes_inpi)|
                |`api/v2/conventions_collectives`|[Conventions collectives ](https://entreprise.api.gouv.fr/catalogue/#conventions_collectives)|
                |`api/v2/exercices`|[Chiffre d'affaires](https://entreprise.api.gouv.fr/catalogue/#exercices)|
                |`api/v2/documents_inpi`|[Bilans annuels INPI](https://entreprise.api.gouv.fr/catalogue/#bilans_inpi)|
                |`api/v2/bilans_entreprises_bdf`|[3 derniers bilans annuels](https://entreprise.api.gouv.fr/catalogue/#bilans_entreprises_bdf)|
                |`api/v2/liasses_fiscales_dgfip`|[D√©clarations de r√©sultat](https://entreprise.api.gouv.fr/catalogue/#liasses_fiscales_dgfip)|
                |`api/v2/attestations_fiscales_dgfip`|[Attestation fiscale](https://entreprise.api.gouv.fr/catalogue/#attestations_fiscales_dgfip)|
                |`api/v2/attestations_sociales_acoss`|[Attestation de vigilance](https://entreprise.api.gouv.fr/catalogue/#attestations_sociales_acoss)|
                |`api/v2/attestations_agefiph`|[Conformit√© emploi des travailleurs handicap√©s](https://entreprise.api.gouv.fr/catalogue/#attestations_agefiph)|
                |`api/v2/cotisations_msa`|[Cotisations de s√©curit√© sociale agricole](https://entreprise.api.gouv.fr/catalogue/#cotisations_msa)|
                |`api/v2/attestations_cotisation_retraite_probtp`|[Attestation de cotisations retraite du b√¢timent](https://entreprise.api.gouv.fr/catalogue/#cotisation_retraite_probtp)|
                |`api/v2/eligibilites_cotisation_retraite_probtp`|[√âligibilit√© au cotisations retraite du b√¢timent](https://entreprise.api.gouv.fr/catalogue/#cotisation_retraite_probtp)|
                |`api/v2/cartes_professionnelles_fntp`|[Carte professionnelle travaux publics](https://entreprise.api.gouv.fr/catalogue/#cartes_professionnelles_fntp)|
                |`api/v2/certificats_cnetp`|[Cotisations cong√©s pay√©s & ch√¥mage intemp√©ries](https://entreprise.api.gouv.fr/catalogue/#certificats_cnetp)|
                |`api/v2/certificats_rge_ademe`|[Certification RGE](https://entreprise.api.gouv.fr/catalogue/#certificats_rge_ademe)|
                |`api/v2/certificats_qualibat`|[Certificat de qualification b√¢timent](https://entreprise.api.gouv.fr/catalogue/#certificats_qualibat)|
                |`api/v2/certificats_opqibi`|[Certification de qualification d'ing√©nierie](https://entreprise.api.gouv.fr/catalogue/#certificats_opqibi)|
                |`api/v2/extraits_courts_inpi`|[Brevets mod√®les et marques d√©pos√©s](https://entreprise.api.gouv.fr/catalogue/#extraits_courts_inpi)|
                |`api/v2/effectifs_mensuels_etablissement_acoss_covid`|Effectifs mensuels par √©tablissement (aides COVID-19) - documentation √† venir|
                |`api/v2/effectifs_mensuels_entreprise_acoss_covid`|Effectifs mensuels par entreprise (aides COVID-19) - documentation √† venir|
                |`api/v2/effectifs_annuels_entreprise_acoss_covid`|Effectifs annuels par entreprise (aides COVID-19) - documentation √† venir|

                ‚ÑπÔ∏è Pour plus d'informations, vous pouvez vous r√©f√©rer √† l'[environnement de production document√© (*swagger*) disponible sur api.gouv.fr](https://api.gouv.fr/documentation/api-entreprise).

                ### Retrouver les droits d'un JWT

                Pour conna√Ætre **la liste des APIs auxquelles vous avez le droit** avec votre jeton d'acc√®s, vous pouvez le v√©rifier avec l'API `/privileges`.

                Si vous g√©rez les tokens pour vos clients, vous pouvez aussi utiliser cette API pour v√©rifier les droits associ√©s √† leurs tokens.

                ###### La requ√™te HTTP :

                ```
                https://entreprise.api.gouv.fr/v2/privileges?token=LeTokenATester
                ```

                Le param√®tre d'appel √† renseigner est le token dont vous souhaitez conna√Ætre les droits.

                > **Exemple de r√©ponse JSON :**
                >```
                >      {
                >        "privileges": [
                >          "attestations_agefiph",
                >          [...]
                >          "actes_bilans_inpi"
                >        ]
                >      }
                >     ```

                La r√©ponse JSON renvoie la liste des API autoris√©es. Retrouvez-leurs sp√©ciifications techniques dans le [Swagger](TODO).

          - section: |+
              ## üß∞ Kit de mise en production

              ### R√©cup√©rer le jeton JWT üîë

              Seule la personne ayant fait la demande d'habilitation a acc√®s au [token](../entreprise.api.gouv.fr/doc/#tokens), au travers du tableau de bord. **Elle est responsable de cette cl√© et de sa transmission s√©curis√©e** si cela est n√©cessaire dans le cadre de l'int√©gration de l'API Entreprise.

              - _Si vous avez r√©alis√© la demande d'habilitation_, vous pouvez **r√©cup√©rer vos tokens ou jetons d'acc√®s directement depuis votre [tableau de bord](https://dashboard.entreprise.api.gouv.fr/login)**.

              - _Si vous avez r√©alis√© la demande d'habilitation mais que vous n'√™tes pas la personne en charge d'int√©grer l'API Entreprise_, **vous pouvez transmettre le token de fa√ßon s√©curis√©e depuis votre [tableau de bord](https://dashboard.entreprise.api.gouv.fr/login)**, en cliquant sur le bouton _"Transmettre le jeton √† mon √©quipe technique"_.

              **Le destinataire recevra, par e-mail, un lien d'une dur√©e de 4 heures**, o√π il pourra copier/coller le token.

              > ‚ö†Ô∏è Votre [cl√© d'acc√®s est unique et priv√©e](TODO vers qu'est qu'unjeton). L'utilisation de cette fonctionnalit√© du tableau de bord doit avoir pour unique objectif la transmission s√©curis√©e de votre cl√© √† vos services techniques qui int√©greront l'API Entreprise. **Vous ne devez jamais transmettre votre cl√© d'acc√®s par e-mail.**

              ### Faire sa premi√®re requ√™te

              #### Utiliser l'environnement de production - _Swagger_

              Apr√®s avoir r√©cup√©r√© votre jeton, vous pouvez donc d√©sormais faire un premier appel de test.

              Utilisez l'[environnement de production document√© (_Swagger_)](https://api.gouv.fr/documentation/api-entreprise), disponible sur api.gouv.fr.
              Il permet, √† l'aide d'un token d'authentification valide üîë, d'effectuer directement depuis le navigateur des tests de l'API. Les donn√©es confidentielles restent bien prot√©g√©es. Vous y trouverez aussi la sp√©cification technique t√©l√©chargeable sous format YAML afin de pouvoir acc√©l√©rer le d√©veloppement de vos outils d'interfa√ßage avec API Entreprise.

              > ‚ö†Ô∏è Attention, pour rappel, vous ne devez jamais copier-coller un token dans la barre de recherche classique d'un moteur de recherche ou dans un e-mail. Pour r√©cup√©rer votre jeton de fa√ßon s√©curis√©e, consultez cette [rubrique](TODO).


              #### √âl√©ments constitutifs de la requ√™te HTTP d'API Entreprise

              Chaque URL de requ√™te est sp√©cifi√©e dans la [documentation technique (_Swagger_) d√©di√©e √† chaque API](../doc/){:trarget="_blank_"},

              ###### Exemple de requ√™te :

              ```
              https://entreprise.api.gouv.fr/v3/attestation_fiscales_dgfip/SirenDeL‚ÄôEntreprise?token=üìù&user_id=üìù&context=üìù&recipient=üìù&object=üìù
              ```


              | √âl√©ments composant la requ√™te              |   √âtat    | Exemples      |
              |--------------------------------------------|-----------|---------------|
              |**Domaine** <br>(ou pr√©fixe) <br>qui conduit √† l'API de fa√ßon s√©curis√©e| pr√©d√©fini par endpoint|`https://entreprise.api.gouv.fr`|
              |**Num√©ro de la version** <br>(par d√©faut d√©sormais en V3)| pr√©d√©fini par endpoint| `/v3`|
              |**Nom de la donn√©e recherch√©e** <br>(ou *endpoint*)| pr√©d√©fini par endpoint| `/attestation_fiscale_dgfip`|
              |**Identit√© de l'√©tablissement concern√©** <br>(souvent SIREN ou SIRET)| √† choisir üìù|`/SIRENouSIRETdeL'Etablissement`|
              |**Votre jeton d'acc√®s**| √† renseigner üìù|`?token=JetonD'Habilitation`|
              |**Des param√®tres de tra√ßabilit√©**| √† renseigner üìù| `&context=CadreDeLaRequ√™te`<br> ‚ÑπÔ∏è Plus d'informations disponibles dans la partie [Instruire les param√®tres de tra√ßabilit√©](TODO){:target="_blank"}|

              #### Constatez votre premi√®re trace d‚Äôappel depuis le tableau de bord

              Une fois que vous avez fait un premier appel, celui-ci est **r√©pertori√©** dans votre tableau de bord, en passant par [la liste de tous vos tokens](https://dashboard.entreprise.api.gouv.fr/me/tokens), et en cliquant sur "Voir les statistiques".

              ### Configurer le logiciel m√©tier
          - section: |+
              ## Sp√©cifications techniques de chaque API & Swagger

          - section: |+
              ## Rupture de service, incidents et maintenances

              Le service ne r√©pond plus, consultez [cette rubrique de notre FAQ](TODO).

              Pour √™tre inform√© des diff√©rentes indisponibilit√©s, [abonnez-vous aux notificiations par e-mail depuis notre page de statuts](https://status.entreprise.api.gouv.fr/subscribe/email).

          - section: |+
              ## Renouvellement du JWT üîë

              Pour comprendre comment renouveler votre jeton, consultez [cette rubrique de notre FAQ](TODO).
