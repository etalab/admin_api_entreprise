---
fr:
  api_particulier:
    documentation_pages:
      guide_migration:
        title: Guide de migration&nbsp;üìã
        sections:
          - anchor: 'introduction'
            title: Introduction
            content: |+
              **Ce guide liste les changements effectu√©s entre la version 2 de l‚ÄôAPI&nbsp;Particulier et la version 3, et vous livre les √©l√©ments n√©cessaires pour effectuer la migration**.

              Les √©volutions pr√©sent√©es ici ont √©t√© guid√©es par trois objectifs&nbsp;:&nbsp;
              - assurer une meilleure s√©curit√© de la donn√©e des fournisseurs ;
              - normaliser les formats pour faciliter la compr√©hension et l‚Äôindustrialisation ;
              - clarifier la documentation et simplifier les routes des diff√©rentes modalit√©s d'appel ;
              - clarifier, documenter les r√©ponses et les rendre actionnables par vos logiciels ;
              - faire converger l'architecture technique de l'API Particulier avec celle de l'API Entreprise.

              {:.fr-highlight.fr}
              > **Votre jeton d'acc√®s reste identique üîë**
              > Pour acc√©der √† la version 3 de l'API&nbsp;Particulier, utilisez le m√™me token qu'en V.2. En effet, tant que votre jeton est valide, il est inutile de refaire une demande d'acc√®s car la migration vers la V.3 ne change pas les droits que vous avez d√©j√† obtenu.
          - anchor: 'evolutions-generales'
            title: √âvolutions g√©n√©rales
            subsections:
              - title: 1. Jeton d'acc√®s √† param√©trer dans le header
                anchor: 'jeton-dacc√®s-√†-param√©trer-dans-le-header-'
                content: |+
                  **üöÄ Avec la V.3 :** Le jeton est √† param√©trer uniquement dans le header de l‚Äôappel.

                  {:.fr-highlight.fr-highlight--example}
                  > **Avant** : Le jeton JWT pouvait √™tre un param√®tre de l‚ÄôURL d‚Äôappel (query parameter).

                  **ü§î Pourquoi ?**
                  - Respecter les standards de s√©curit√© ;
                  - Garantir que le token ne sera pas utilis√© dans un navigateur.

                  **üß∞ Comment ?**
                  Utilisez un client REST API pour tester les API pendant le d√©veloppement.
                  Des clients sont disponibles gratuitement. API&nbsp;Particulier utilise pour ses propres tests le client Insomnia. Le plus connu sur le march√© est Postman.
                  Une fois le client install√©, vous pouvez directement int√©grer notre fichier [Swagger/OpenAPI](<%= developers_openapi_path %>){:target="_blank"} dedans.

              - title: 2. Votre num√©ro de SIRET obligatoire dans le "recipient"
                anchor: 'votre-num√©ro-de-siret-obligatoire-dans-le-recipient'
                content: |+
                  **üöÄ Avec la V.3 :** Le param√®tre obligatoire `recipient` de l‚ÄôURL d‚Äôappel devra obligatoirement √™tre compl√©t√© par votre num√©ro de SIRET.

                  {:.fr-highlight.fr-highlight--example}
                  > **Avant** : Ce param√®tre obligatoire n‚Äô√©tait pas contraint en termes de syntaxe.

                  **ü§î Pourquoi ?**
                  - Pour garantir la tra√ßabilit√© de l‚Äôappel jusqu‚Äôau b√©n√©ficiaire ayant obtenu l‚Äôhabilitation √† appeler l‚ÄôAPI&nbsp;Particulier et respecter nos engagements aupr√®s des fournisseurs de donn√©es ;
                  - Nous avions trop d‚Äôutilisateurs inscrivant le num√©ro de SIRET ou RNA de l‚Äôentreprise/association recherch√©e.

                  {:.fr-highlight.fr-highlight--caution}
                  > **‚ö†Ô∏è Cas particulier**, _vous √™tes un √©diteur ?_
                  > Ce n‚Äôest pas votre num√©ro de SIRET mais celui de votre client public qu‚Äôil s‚Äôagira de renseigner. API&nbsp;Particulier doit pouvoir tracer pour quelle entit√© publique l'appel a √©t√© pass√©.

                  Pour en savoir plus sur les param√®tres obligatoires d'appel, consultez les [sp√©cifications techniques](<%= developers_path(anchor: 'renseigner-les-param√®tres-dappel-et-de-tra√ßabilit√©') %>).

              - title: 3. Codes erreurs sp√©cifiques √† chaque situation, actionnables et document√©s
                anchor: 'codes-erreurs-sp√©cifiques-√†-chaque-situation-actionnables-et-document√©s'
                content: |+
                  **üöÄ Avec la V.3 :** Tous les codes erreur HTTPS sont accompagn√©s de codes plus pr√©cis, sp√©cifiques √† chaque situation d‚Äôerreur. Une explication en toutes lettres est √©galement donn√©e dans la payload. Enfin, dans certains cas, une m√©tadonn√©e actionnable est disponible.

                  Dans l‚Äôexemple ci-dessous, la cl√© `retry_in` permet de relancer un appel apr√®s le nombre de secondes indiqu√©es.

                  ###### Exemple de _payload_ d‚Äôun code HTTP 502 :
                  ```
                  {
                    "errors": [
                      {
                        "code": "04501",
                        "title": "Analyse de la situation du compte en cours",
                        "detail": "La situation de l'entreprise requiert une
                                   analyse manuelle d'un agent de l'URSSAF.
                                   Une demande d'analyse vient d'√™tre envoy√©e,
                                   cela prend au maximum 2 jours.",
                        "meta": {
                          "provider": "ACOSS",
                          "retry_in": 172800
                        }
                      }
                    ]
                  }
                  ```

                  {:.fr-highlight.fr-highlight--example}
                  > Avant : Seul le code HTTP standard vous √©tait fourni. Il pouvait correspondre √† de nombreuses situations.
                  > ###### Exemple de payload d‚Äôun code HTTP 502 :
                  > ```
                  > {
                  >   "errors": [
                  >     "L'ACOSS ne peut r√©pondre √† votre requ√™te, r√©essayez ult√©rieurement  (erreur: Analyse de la situation du compte en cours)"
                  >   ]
                  > }
                  > ```

                  **ü§î Pourquoi ?**
                  - Pour pr√©ciser la nature de l‚Äôerreur et vous aider √† la comprendre ;
                  - Pour vous permettre d‚Äôactionner automatiquement l‚Äôerreur en utilisant le code.


                  **üß∞ Comment ?**
                  Utiliser les libell√©s pour comprendre l‚Äôerreur rencontr√©e, voire automatiser votre logiciel en fonction du code.
                  La liste de tous les codes erreurs sp√©cifiques (environ 80) est disponible dans le [Swagger](<%= developers_openapi_path %>){:target="_blank"}. La gestion des erreurs et l'explication des codes retours est d√©taill√©e dans la [documentation technique g√©n√©rale](<%= developers_path(anchor: 'code-https-et-gestion-des-erreurs') %>){:target="_blank"}.

              - title: 4. Volum√©trie indiqu√©e dans le header et actionnable
                anchor: 'volum√©trie-indiqu√©e-dans-le-header-et-actionnable'
                content: |+
                  La gestion de la volum√©trie est maintenue identique √† la derni√®re √©volution de la V.2 et expliqu√©e dans cette [documentation](<%= developers_path(anchor: 'volum√©trie') %>)

              - title: 5. Une route sp√©cifique pour chaque modalit√© d'appel
                anchor: 'une-route-specifique-pour-chaque-modalite-d-appel'
                content: |+
                  **üöÄ Avec la V.3 :** Chaque modalit√© d'appel d'une API a son propre endpoint

                  D√©sormais avec la V.3. chaque modalit√© d'appel a son propre endpoint, mat√©rialis√© ainsi dans l'URL d'appel :
                  - `/identite`, pour les appels avec les param√®tres de l'identit√© pivot du particulier ;
                  - `/france_connect`, pour les appels avec FranceConnect ;
                  - `/identifiant`, pour les appels avec un num√©ro unique sp√©cifique √† l'API.

                  {:.fr-highlight.fr-highlight--example}
                  > **Avant** : Dans la V.2., une seule route existait par API, ce qui signifiait que les diff√©rentes modalit√©s d'appel √©taient toutes document√©es au m√™me endroit, entrainant plusieurs difficult√©s, dont notamment le fait de ne pas pouvoir rendre obligatoires certains param√®tre pourtant obligatoires dans les faits.

                  **ü§î Pourquoi ?**
                  - Clarifier la documentation des param√®tres d'appel ;
                  - Identifier pr√©cis√©mement les param√®tres obligatoires ;
                  - Rendre actionnable le swagger et le fichier OpenAPI.

                  **üß∞ Comment ?**
                  Utiliser [le swagger](<%= developers_openapi_path %>){:target="_blank"}.
              
              - title: 6. Les donn√©es des payloads, qualifi√©es et uniformis√©es d'un point de vue m√©tier
                anchor: 'donnee-qualifiee-et-uniformisee-metier'
                content: |+
                  **üöÄ Avec la V.3 :** Nous avons profit√© de la refonte technique pour uniformiser la fa√ßon de traiter la donn√©e entre les API et compl√©ter significativement les documentations. Ces √©volutions concernent plusieurs aspects : 
                  - **Normaliser et pr√©ciser les cl√©s de certains champs qui d√©finissent le m√™me type d'information**. Ainsi quelques r√®gles sont maintenant largement utilis√©es sur toutes les API, par exemple :
                    - le statut (√©tudiant, b√©n√©ficaire d'une prestation, etc.) est d√©sormais toujours nomm√© par une cl√© pr√©fix√©e par `est_...`, comme par exemple `est_boursier` ou `est_beneficiaire` ;
                    - les dates de d√©but et de fin de droit auront les cl√©s `date_debut_droit` / `date_fin_droit` ;
                    - les cl√©s se veulent les plus pr√©cises possibles, par exemple, dans l'API √©tudiant, : la cl√© `code_commune` en V.2. devient `code_cog_insee_commune` en V.3. pour √©viter toute confusion avec le code postal. 
                  - **Expliciter l'origine des diverses donn√©es d'identit√© transmises dans les payloads** et pr√©ciser si la donn√©e a √©t√© consolid√©e et comment. Par exemple : au travers d'un recoupement avec une pi√®ce d'identit√© ou bien avec un r√©pertoire ; 
                  - Uniformiser le style des cl√©s pour faciliter votre lecture de la documentation. Le format choisi est d√©sormais en XXXX TODO, c'est-√†-dire que les mots sont s√©par√©s par des _, par exemple `code_cog_insee_commune`.

                  **ü§î Pourquoi ?**
                  - Simplifier la compr√©hension et la lecture des donn√©es transmises ;
                  - Faciliter l'int√©gration de l'API.


              - title: 7. Des payloads permettant de rep√©rer plus facilement les scopes (droits d'acc√®s)
                anchor: 'payloads-permettant-de-reperer-les-scopes'
                content: |+
                  **üöÄ Avec la V.3 :** Les scopes sont rep√©rables plus facilement car ils sont incarn√©s par une seule cl√© (qui peut √™tre une cl√© parente) et qui dans la mesure du possible se trouve √† la racine du tableau `"data"`. Ce changement est particuli√®rement visible sur l'API statut √©tudiant boursier : 

                  ###### Exemple avec la payload V.3. de l'API √âtudiant boursier :
                  Dans cette payload, les diff√©rents scopes pour lesquels vous pouvez demander une habilitation sont tr√®s visibles :  

                  ```
                    {
                      "data": {
                        "identite": {   ## Scope "identit√©"
                          "nom": "Moustaki",
                          "prenoms": ["Georges", "Claude"],
                          "date_naissance": "1992-11-29",
                          "nom_commune_naissance": "Poitiers",
                          "sexe": "M"
                        },
                        "est_boursier": true, ## Scope "statut"
                        "periode_versement_bourse": { ## Scope "P√©riode de versement"
                          "date_rentree": "2019-09-01",
                          "duree": 12
                        },
                        "etablissement_etudes": { ## Scope "√âtablissement et ville d'√©tudes"
                          "nom_commune": "Brest",
                          "nom_etablissement": "Carnot"
                        },
                        "echelon_bourse": "6", ## Scope "√âchelon de la bourse"
                        "email": "georges@moustaki.fr", ## Scope "E-mail
                        "statut_bourse": { ## Scope "Statut d√©finitif de la bourse"
                          "code": 0,
                          "libelle": "d√©finitif"
                        }
                      },
                      "links": {},
                      "meta": {}
                    }
                  ```

                  {:.fr-highlight.fr-highlight--example}
                  > Avant : Les droits d'acc√®s pouvait couvrir une ou plusieurs cl√©s dans la payload, il n'y avait pas de r√®gles. Dans certains cas, un scope pouvait m√™me indiquer un p√©rim√®tre de particuliers concern√©s.

                  > ###### Exemple avec la payload V.2. de l'API √âtudiant boursier :
                  > ```
                  > {
                  >   "data": {
                  >     "nom": "Moustaki",
                  >     "prenom": "Georges",
                  >     "prenom2": "Claude",
                  >     "date_naissance": "1992-11-29",
                  >     "lieu_naissance": "Poitiers",
                  >     "sexe": "M",
                  >     "boursier": true,
                  >     "echelon_bourse": "6",
                  >     "email": "georges@moustaki.fr",
                  >     "date_de_rentree": "2019-09-01",
                  >     "duree_versement": 12,
                  >     "statut": 0,
                  >     "statut_libelle": "d√©finitif",
                  >     "ville_etudes": "Brest",
                  >     "etablissement": "Carnot"
                  >   },
                  >   "links": {},
                  >   "meta": {}
                  > }
                  > ```

                  **ü§î Pourquoi ?**
                  Clarifier quelles informations sont disponibles pour chaque scope.
              
              - title: 8. Certains scopes ont √©t√© cr√©√©s / supprim√©s / modifi√©s
                anchor: 'certains-scopes-crees-modifies-supprimes'
                content: |+
                  **üöÄ Avec la V.3 :** Certains scopes (droits d'acc√®s) ont √©t√© modifi√©s : 
                  - API Statut demandeur d'emploi : Le scope `pole_emploi_identifiant` a √©t√© cr√©√©. Par cons√©quent, l'identifiant p√¥le emploi n'est plus retourn√© par d√©faut par l'API.
                  - API Statut √©l√®ve scolaris√© : Le scope `men_statut_identite` a √©t√© cr√©√©. Par cons√©quent, les donn√©es d'identit√© de l'√©l√®ve (nom, pr√©nom, sexe et date de naissance) ne sont plus retourn√©es par d√©faut par l'API.
                  - API Statut √©tudiant : Les scopes de cette API ont √©t√© largement transform√©s car ils √©taient incompr√©hensibles. Les scopes `mesri_inscription_etudiant`, `mesri_inscription_autre` et  `mesri_admission` ont donc √©t√© supprim√©s et remplac√©s par un seul et m√™me scope : `mesri_admissions`. Le scope `mesri_regime` a √©t√© cr√©√©. Par cons√©quent, le r√©gime de formation de l'√©l√®ve n'est plus donn√© par d√©faut.
                  XXXX TODO => Mieux comprendre les scopes

                  {:.fr-highlight.fr-highlight--example}
                  > **Avant** : Dans la V.2., 

                  **ü§î Pourquoi ?**
                  - De nouveaux scopes ont √©t√© cr√©√©s afin de r√©pondre aux exigences de l'[article 4 de la loi informatique et libert√©s](https://www.legifrance.gouv.fr/loda/article_lc/LEGIARTI000037822953/){:target="_blank"} qui stipule que seules les donn√©es strictement n√©cessaires √† la r√©alisation des missions peuvent √™tre manipul√©es. La cr√©ation de nouveaux scopes permet une meilleure granularit√©
                  - Certains scopes filtraient les √©tudiant transmis selon leur r√©gime de formation. Ce fonctionnement n'a pas lieu d'√™tre, rendait la compr√©hension des scopes tr√®s difficile, il a donc √©t√© supprim√©.

                  **üß∞ Comment ?**
                  - Si vous aviez d√©j√† demand√© une habilitation pour les API statut demandeur d'emploi ou √©l√®ve scolaris√©, les scopes `pole_emploi_identifiant` et `men_statut_identite`, qui √©taient disponibles par d√©faut en V.2. vous ont automatiquement √©t√© attribu√©s. Vous n'avez rien √† faire.
                  -

              - title: 8. Les appels via la modalit√© FranceConnect ne renvoient plus les donn√©es d'identit√©
                anchor: 'une-route-specifique-pour-chaque-modalite-d-appel'
                content: |+
                  **üöÄ Avec la V.3 :** Lorsque vous utilisez les API avec FranceConnect, les donn√©es d'identit√© du particulier regroup√©es sous la cl√© `"identite"` ne seront plus renvoy√©es. 

                  **ü§î Pourquoi ?**
                  - C'est un imp√©ratif de FranceConnect ; 
                  - FranceConnect est en possession de l'identit√© pivot de l'usager, ces donn√©es sont certifi√©es et parfois plus fiables que les donn√©es livr√©es par les API, si vous avez besoin des donn√©es d'identit√©, vous pouvez donc les r√©cup√©rer directement via FranceConnect.

                  **üß∞ Comment ?**
                  XXXXX TODO

              - title: 9. Gestion des √©volutions futures
                anchor: 'gestion-des-√©volutions-futures'
                content: |+
                  **üöÄ Avec la V.3 :** Toutes les API pourront √©voluer ind√©pendamment les unes des autres. Les anciennes versions resteront disponibles si le fournisseur de la donn√©e continue de nous transmettre les informations. Le num√©ro de version devient donc un param√®tre de l‚Äôappel et non plus une valeur fixe pour toutes les API.
                  üì© Une infolettre annoncera syst√©matiquement les nouvelles √©volutions.

                  {:.fr-highlight.fr-highlight--example}
                  > **Avant** : L‚Äô√©volution d‚Äôun endpoint exigeait la mont√©e en version de toute l‚ÄôAPI.

                  **ü§î Pourquoi ?**
                  - Permettre l‚Äôajout de nouvelles informations sans forcer les fournisseurs de service √† monter de version ;
                  - Continuer de garantir la continuit√© des API dans le temps.

                  **üß∞ Comment ?**
                  Renseigner directement le num√©ro de la version voulue dans l‚ÄôURL, au m√™me endroit qu‚Äôavant, par exemple :
                  ```
                  https://particulier.api.gouv.fr/v3/mesri/statut_etudiant/identite
                  ```
      
      developers:
        title: Espace d√©veloppeurs&nbsp;üõ†
        sections:
          - anchor: 'prerequis-techniques'
            title: Pr√©requis techniques
            content: |+
              Voici la liste des **fondamentaux techniques √† mettre en place pour le bon fonctionnement de l‚ÄôAPI&nbsp;Particulier**&nbsp;:

              - ‚òëÔ∏è √ätre en mesure de g√©rer le protocole HTTPS ;
              - ‚òëÔ∏è Avoir une version de langage r√©cente. Si vous utilisez Java, une version >= 1.8 est n√©cessaire (pour la gestion des certificats de +1024 bit, du TLS 1.2 minimum et des suites cryptographiques - ciphers) ;
              - ‚òëÔ∏è S‚Äôassurer que nos Autorit√©s de Certification (AC) pour les certificats SSL sont autoris√©es par vos syst√®mes ;
              - ‚òëÔ∏è L'API&nbsp;Particulier est uniquement accessible par internet. Si vous avez un pare-feu, il faut donc pr√©voir de whitelister l'adresse IP du service API&nbsp;Particulier ;
              - ‚òëÔ∏è Il est interdit d'interroger l'API&nbsp;Particulier depuis un site web en front-end, car le jeton d'acc√®s serait alors divulgu√©. Il vous faut donc interroger nos API depuis une application en back-end. Nous n'autoriserons pas le CORS (CORS - Cross Origin Ressource Sharing) ;
              - ‚òëÔ∏è Pr√©voir non seulement les co√ªts de d√©veloppement mais √©galement les co√ªts de maintenance ;
              - ‚òëÔ∏è √ätre en capacit√© de g√©rer les mises √† jour de l'API&nbsp;Particulier.

              <br>

              {:.fr-highlight}
              > üí° Pour mieux comprendre l'API&nbsp;Particulier avant de demander un acc√®s, **vous pouvez utiliser [notre environnement de test](<%= developers_path(anchor: 'tester-api-preproduction') %>)**.

          - anchor: 'specifications-generales'
            title: Sp√©cifications g√©n√©rales&nbsp;üéõ
            subsections:
              - title: Respecter la volum√©trie
                anchor: 'respecter-la-volum√©trie'
                content: |+
                  #### Les plafonds

                  Les limites de volum√©trie sur API&nbsp;Particulier se d√©composent en deux r√®gles principales&nbsp;:&nbsp;

                  - **Un plafond g√©n√©ral par IP de 1000 requ√™tes/minute** ;

                  - **Une volum√©trie par jeton&nbsp;:** 20 requ√™tes/secondes.

                  #### Informations volum√©trie dans le header

                  ##### Pour toutes les r√©ponses&nbsp;:

                  Dans toutes les r√©ponses de nos API, le header vous transmet des informations sur la volum√©trie&nbsp;:

                  {:.fr-table}
                  | Champs du header    |   Signification    |     Format           |
                  |:------------------------------|:------------------|:------------:|
                  | `RateLimit-Limit` |La **limite** concernant l'endpoint appel√©, soit le nombre de requ√™te/minute. | Nombre|
                  | `RateLimit-Remaining` |Le **nombre d'appels restants** durant la p√©riode courante d'une minute. | Nombre |
                  | `RateLimit-Reset` |La **fin de la p√©riode** courante. | Timestamp |

                  {:.fr-highlight.fr-highlight--example}
                  > **Exemple&nbsp;:**
                  > Consid√©rons un endpoint ayant une limite de 50 appels /minute.
                  > Vous fa√Ætes un premier appel √† 10h00 pile, et effectuez un second appel 20 secondes plus tard, puis un troisi√®me 10 secondes plus tard, vous aurez les valeurs suivantes :
                  > - `RateLimit-Limit` : 50 ;
                  > - `RateLimit-Remaining` : 47 (50 moins les 3 appels effectu√©s) ;
                  > - `RateLimit-Reset` : [*Timestamp correspondant au jour pr√©sent √† 10h01*]. Le premier appel initialise le compteur (√† 10h00 pile), la p√©riode se termine 1min plus tard.
                  >
                  > Vous pouvez donc jusqu'√† 10h01 pile effectuer 47 appels, le compteur sera r√©initialis√© √† 50 √† ce moment-l√†.

                  ##### En cas de d√©passement :

                  Si vous d√©passez le nombre d'appels autoris√©s (`RateLimit-Remaining = 0`), le serveur r√©pondra avec le `status 429` sur tous les appels suivants dans la m√™me p√©riode.

                  Le header associ√© √† ce code erreur `429` sera accompagn√©&nbsp;:&nbsp;
                  - des trois champs pr√©c√©dents ;
                  - d'un champ suppl√©mentaire indiquant le temps √† attendre avant de pouvoir effectuer des nouveaux appels.

                  {:.fr-table}
                  | Champs du header    |   Signification    |     Format           |
                  |:------------------------------|:------------------|:------------:|
                  | `RateLimit-Limit` |La **limite** concernant l'endpoint appel√©, soit le nombre de requ√™te/minute. | Nombre|
                  | `RateLimit-Remaining` |Le **nombre d'appels restants** durant la p√©riode courante d'une minute. | Nombre |
                  | `RateLimit-Reset` |La **fin de la p√©riode** courante. | Timestamp |
                  | *Uniquement pour le header associ√© au code erreur 429* <br> `Retry-after`| **D√©compte du nombre de secondes restantes** avant la prochaine p√©riode | Secondes |

                  Vous pouvez donc **utiliser les champs du header pour optimiser votre consommation de l'API&nbsp;Particulier**.

                  #### R√®gles de bannissement en cas de surconsommation

                  En cas de non prise en compte des codes erreurs `429` ou en cas de d√©passement de la limite de volum√©trie globale, **votre IP sera temporairement bannie de nos serveurs pour une dur√©e fixe et non r√©vocable de 12h**. Si vous avez plusieurs jetons, tous seront donc bloqu√©s pendant ce laps de temps.

                  Les appels depuis une IP bannie ne renvoient pas de codes HTTP, le serveur ne r√©pond tout simplement pas.

                  {:.fr-highlight}
                  > ‚ÑπÔ∏è Au bout de ces 12 heures, vos acc√®s sont automatiquement r√©tablis ; **il est donc inutile d'√©crire au support**.

                  Nous vous invitons √† prendre les mesures n√©cessaires car le d√©passement intervient g√©n√©ralement chez nos utilisateurs lorsque leur programme n'a pas √©t√© correctement configur√©.

                  Pour les appels de traitement de masse, il est souhaitable que vous fassiez vos **batchs automatiques la nuit ou durant les heures creuses** afin de ne pas affecter la qualit√© du service pour le reste des usagers.

              - title: Configurer vos timeout
                anchor: 'configurer-vos-timeout'
                content: |+
                  Le timeout est le temps d'attente maximal de r√©ponse √† une requ√™te. Il vous permet de ne pas immobiliser votre logiciel en le laissant bloqu√© sur un appel sans r√©ponse.

                  De fa√ßon g√©n√©rale, nous vous recommandons un timeout de **5 secondes**.

                  De m√™me, pour ne pas immobiliser nos serveurs, nous attendons les r√©ponses de nos fournisseurs un maximum de 10 secondes avant de vous les retransmettre. Si ce d√©lai d‚Äôattente est d√©pass√© un code erreur HTTP `504` vous sera renvoy√©.

              - title: Autoriser nos Autorit√©s de Certifications
                anchor: 'autoriser-nos-autorit√©s-de-certifications'
                content: |+
                  API&nbsp;Particulier utilise [DHIMYOTIS](https://www.dhimyotis.com/) comme organisme de d√©livrance de ses certificats SSL principaux ainsi que [Let's Encrypt](https://letsencrypt.org/) pour certains services secondaires.

                  Il est conseill√© d'ajouter ces Autorit√©s de Certifications (AC) √† votre base de confiance si vous en avez une. Une solution id√©ale est d'utiliser un paquet d'autorit√©s mises √† jour automatiquement ([Mozilla par exemple](https://wiki.mozilla.org/CA/Included_Certificates))

                  API&nbsp;Particulier utilise des certificats multi-domaines ; c'es-√†-dire avec un "nom courant" (_common name - CN_) et plusieurs "noms alternatifs du sujet" (_subject alternatives names - SAN_), **soyez certains que vos outils fonctionnent correctement avec**.

              - title: G√©rer les erreurs - codes HTTPS
                anchor: 'g√©rer-les-erreurs---codes-https'
                content: |+
                  #### Un code standard HTTPS pour cat√©goriser le statut de l'appel

                  Toutes les r√©ponse de l‚ÄôAPI&nbsp;Particulier sont envoy√©es avec un code HTTPS. **Ces codes permettent de se renseigner sur le statut de l‚Äôappel**, et sont harmonis√©s pour l'ensemble des API quelque soit le fournisseur de donn√©es.
                  Pour en savoir plus sur les codes HTTPS, cet article de [Wikipedia](https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP){:target="_blank"} constitue une bonne base explicative.

                  ##### En cas de succ√®s, le code HTTP commence par 2 :

                  {:.fr-table}
                  | Code HTTPS                                       |      Signification                 |
                  |--------------------------------------------------|------------------------------------|
                  |`200` | **Tout va bien.**|

                  ##### En cas d‚Äô√©chec, si l‚Äôerreur vient de votre c√¥t√©, le code HTTP commence par 4 :

                  {:.fr-table}
                  | Code HTTP                       |      Signification                     |
                  |---------------------------------|----------------------------------------|
                  |`400` | **Mauvaise requ√™te** ‚Äì La syntaxe de votre requ√™te est erron√©e: les param√®tres ne sont pas valides.|
                  |`401` | **Non autoris√©** ‚Äì Votre token est invalide ou manquant.|
                  |`403` | **Interdit** ‚Äì Le serveur a compris votre requ√™te mais refuse de l‚Äôex√©cuter car votre jeton ne vous donne pas acc√®s √† cette ressource.|
                  |`404` | **Non trouv√©** ‚Äì La ressource demand√©e n'a pas √©t√© trouv√©e. |


                  ###### En cas d‚Äô√©chec, si l‚Äôerreur provient d‚ÄôAPI&nbsp;Particulier ou bien des fournisseurs de donn√©es, le code HTTP commence par 5 :

                  {:.fr-table}
                  | Code HTTP                        |      Signification                     |
                  |----------------------------------|----------------------------------------|
                  |`500` | **Erreur interne √† API&nbsp;Particulier** ‚Äì Une erreur interne du serveur d‚ÄôAPI&nbsp;Particulier est survenue.
                  |`502` | **Erreur interne fournisseur** ‚Äì Une erreur interne du serveur du ou des fournisseurs est survenue. [Consultez votre compte utilisateur](<%= authorization_requests_path %>){:target="_blank"}, l‚Äôhistorique de l‚Äôincident devrait y √™tre affich√© ; ainsi que les actions √† venir.
                  |`503` | **Service non disponible** ‚Äì Le service est temporairement indisponible ou en maintenance. Pour conna√Ætre l‚Äôhistorique de disponibilit√© et les incidents type de l‚Äôendpoint, vous pouvez [consulter le catalogue de donn√©es](../catalogue/).
                  |`504` | **Interm√©diaire hors d√©lai** ‚Äì Le(s) producteur(s) de donn√©es ont mis trop de temps √† r√©pondre. Notre temps d‚Äôattente, nous permettant de ne pas immobiliser le serveur sur un appel sans r√©ponse, est fix√© √† 10 secondes et a √©t√© d√©pass√©.|

                  Retrouvez tous les codes erreurs pour chaque endpoint dans [notre swagger, partie "Response samples"](<%= developers_openapi_path %>){:target="_blank"}.
                  La liste des codes sp√©cifiques √† chaque endpoint y est disponible.
              - title: Renseigner les param√®tres d'appel et de tra√ßabilit√©
                anchor: 'renseigner-les-param√®tres-dappel-et-de-tra√ßabilit√©'
                content: |+
                  API&nbsp;Particulier vous permet d‚Äôacc√©der √† des donn√©es prot√©g√©es. C‚Äôest pourquoi, dans un **objectif de tra√ßabilit√©**, nous vous demandons de renseigner dans chacune de vos requ√™tes, non seulement un jeton d‚Äôacc√®s, mais aussi **certaines informations qualifiant votre requ√™te**.


                  {:.fr-highlight.fr-highlight--caution}
                  > ‚ö†Ô∏è **Ces param√®tres sont obligatoires pour les API FranceConnect√©es. les appels ne comportant pas ces param√®tres sont rejet√©s, et un code erreur vous est renvoy√©. Ces param√®tres sont optionnels pour les API non FranceConnect√©es. Le caract√®re requis de ce champ est pr√©cis√© dans le [swagger](https://particulier.api.gouv.fr/developpeurs/openapi#section/Bienvenue-sur-la-documentation-interactive-d'API-Particulier.).**. 

                  Pour chaque endpoint, nous pr√©cisons dans le [swagger, rubrique "Query parameters"](<%= developers_openapi_path %>){:target="_blank"} les param√®tres obligatoires sp√©cifiques, ci-dessous une explication d√©taill√©e des √©l√©ments √† fournir pour chaque param√®tre de tra√ßabilit√© :

                  {:.fr-table}
                  | Param√®tre                                                  |      Information √† renseigner           |
                  |:----------------------------------------------------------:|-----------------------------------------|
                  |`&recipient=B√©n√©ficaireDeL'Appel`|**Le b√©n√©ficiaire de l'appel** <br><br>Ce param√®tre permet la tra√ßabilit√© de l'appel et doit correspondre au _SIRET de l'organisation publique habilit√©e √† utiliser la donn√©e_. <br><br>Si vous √™tes une collectivit√© ou une administration, ce param√®tre doit donc √™tre votre num√©ro de SIRET. Si vous √™tes un √©diteur, il s'agit du SIRET de l'organisation publique cliente demandant la donn√©e.<br><br>Une v√©rification est effectu√©e par API Particulier pour refuser tout format qui ne serait pas un num√©ro de SIRET.
              - title: Surveiller l'√©tat des fournisseurs
                anchor: 'surveillance-etat-fournisseurs'
                content: |+
                  API Particulier met √† disposition un ensemble de routes de "pings" permettant de r√©cup√©rer l'√©tat des services fournis par les diff√©rents fournisseurs de donn√©es.
                  L'ensemble des routes est disponible √† l'adresse suivante: [Routes de pings (format JSON)](https://particulier.api.gouv.fr/api/pings).

                  Pour chacune de ces routes, l'√©quipe d'API Particulier effectue des v√©rifications sp√©cifiques au fournisseur, permettant d'√™tre au plus pr√®s de la r√©alit√© quand √† la sant√© dud√Æt fournisseur.
                  Chacune de ces routes renvoi un json sous le format suivant:

                  ```json
                  {
                    "status": "ok",
                    "last_update": "2023-11-03T12:24:07.185+01:00",
                    "last_ok_status": "2023-11-03T12:24:07.185+01:00"
                  }
                  ```

                  Avec:
                  - `status`, `string`, qui peut avoir 3 valeurs: `ok` quand tout est OK, `bad_gateway` quand il y a un souci, `unknown` quand on ne peut pas d√©terminer le status ;
                  - `last_update`, `datetime`, date de la derni√®re mise √† jour: pour √©viter de surcharger nos syst√®mes nous effectuons de la mise en cache sur les pings ;
                  - `last_ok_update`, `datetime`, date de la derni√®re mise √† jour en OK: permet de savoir depuis quand le service est en d√©faut.

                  A noter que le status http est √† 200 pour `ok` et `unknown`, 502 pour `bad_gateway` : cela permet √† nos syst√®mes de monitoring de ne pas lever d'alertes en cas de donn√©es insuffisantes (et ainsi √©viter des potentiels faux positifs).

                  Nous vous conseillons de passer par ces routes de surveillances, et ceci pour plusieurs raisons:

                  1. API Particulier s'occupe de la complexit√© vis-√†-vis de la disponibilit√© de certains partenaires (limitation sur le nombre d'appels sur certains identifiants, √©checs al√©atoires etc..) ;
                  2. Il n'y a pas de limitations sur ces routes
                  3. L'impl√©mentation est plus simple que d'utiliser les routes officieles
                  4. Un `bad gateway` d'une route de ping a de forte chance d'√™tre un vrai positif, contrairement √† un √©chec sur les endpoints qui peut √™tre d√ª √† des erreurs r√©seaux/temporaires.

              - title: Retrouver les droits d'un jeton
                anchor: 'retrouver-les-droits-dun-jeton'
                content: |+
                  Pour conna√Ætre **la liste des APIs auxquelles vous avez le droit** avec votre jeton d'acc√®s, vous pouvez le v√©rifier avec l'API `/api/introspect`.

                  Si vous g√©rez les tokens pour vos utilisateurs, vous pouvez aussi utiliser cette API pour v√©rifier les droits associ√©s √† leurs tokens.

                  {:.fr-h5}
                  #### La requ√™te HTTP :

                  ```
                  https://particulier.api.gouv.fr/api/introspect?token=LeTokenATester
                  ```

                  Le param√®tre d'appel √† renseigner est le token dont vous souhaitez conna√Ætre les droits.

                  > **Exemple de r√©ponse JSON :**
                  >```
                  >{
                  >  "_id": "48ed8e98-33e4-4b05-88fe-f933d1b421c4",
                  >  "name": null,
                  >  "scopes": [
                  >    "cnous_statut_boursier",
                  >    [...]
                  >    "cnaf_adresse"
                  >  ]
                  >}
                  > ```

                  La r√©ponse JSON renvoie la liste des API et champs autoris√©es. Retrouvez-leurs sp√©cifications techniques dans le [Swagger](<%= developers_openapi_path %>){:target="_blank_"}.

          - anchor: 'kit-de-mise-en-production'
            title: Kit de mise en production&nbsp;üöÄ
            subsections:
              - title: Tester l'API en pr√©production
                anchor: 'tester-api-preproduction'
                content: |+
                  {:.fr-text--lg}
                  L'API&nbsp;Particulier propose un environnement de test ou bac √† sable pour vous permettre de tester le branchement de l'API avec votre syst√®me d'informations. 
                   
                  {:.fr-highlight}
                  > üí° L'environnement de test est une fonctionnalit√© √† destination des usagers techniques. Si vous √™tes un profil m√©tier, veuillez vous r√©f√©rer aux fiches m√©tier de chaque API disponibles depuis le [catalogue](<%= endpoints_path %>).

                  {:.fr-text--lg}
                  **Les informations essentielles du bac √† sable :**

                  - **Une URL :** L''environnement de staging est appelable avec `https://staging.particulier.api.gouv.fr`.

                  - **Les jetons d'acc√®s** : Pour √™tre fid√®le au fonctionnement de l'API en production, cet environnement de test n√©cessite aussi un jeton d'acc√®s, mais celui-ci, contrairement aux [jetons de production](#r√©cup√©rer-le-jeton-jwt), est public car la donn√©e renvoy√©e en bac √† sable est fictive. Un jeton ayant tous les droits est accessible [ici](https://github.com/etalab/siade_staging_data/blob/develop/tokens/default){:target="_blank"}. Pour g√©n√©rer un jeton sp√©cifique, veuillez vous r√©f√©rer √† ce [tutoriel](https://github.com/etalab/siade_staging_data/tree/develop/tokens){:target="_blank"}.
                  
                  - **Les param√®tres d'appel** : Chaque cas de test documente les param√®tres d'appel n√©cessaires. Vous pouvez aussi tester l'API avec la [modalit√© d'appel FranceConnect](<%= cas_usages_path(uid:'modalite_appel_france_connect') %>) en utilisant de faux jetons FranceConnect fournis dans le staging.

                  - **Les donn√©es fictives de r√©ponse :** Les donn√©es retourn√©es par cet environnement de test sont totalement fictives et disponibles depuis [ce d√©p√¥t](https://github.com/etalab/siade_staging_data/tree/develop/payloads){:target="_blank"}.

                  - **Pour rappel, le fichier OpenAPI est disponible depuis le [swagger](<%= developers_openapi_path %>)**, avec le bouton "Download" situ√© en d√©but de page.

                  **Pour en savoir plus, veuillez consulter le [README du d√©p√¥t Github](https://github.com/etalab/siade_staging_data){:target="_blank"}.**
                  

              - title: R√©cup√©rer le jeton JWT&nbsp;üîë
                anchor: 'r√©cup√©rer-le-jeton-jwt'
                content: |+
                  Seule la personne ayant fait la demande d'habilitation a acc√®s au token, au travers du [compte utilisateur API&nbsp;Particulier](<%= api_particulier_user_profile_path %>){:target="_blank"}.

                  - _Si vous avez r√©alis√© la demande d'habilitation_, vous pouvez **r√©cup√©rer vos tokens ou jetons d'acc√®s directement depuis votre [compte](<%= api_particulier_user_profile_path %>){:target="_blank"}**.

              - title: Faire sa premi√®re requ√™te
                anchor: 'faire-sa-premi√®re-requ√™te'
                content: |+
                  #### Utiliser l'environnement de production - _Swagger_

                  Apr√®s avoir r√©cup√©r√© votre jeton, vous pouvez faire un premier appel de test.

                  Utilisez l'[environnement de production document√© (_Swagger_)](https://api.gouv.fr/documentation/api-particulier){:target="_blank"}, disponible sur api.gouv.fr.
                  Il permet, √† l'aide d'un token d'authentification valide üîë, d'effectuer directement depuis le navigateur des tests de l'API. Les donn√©es confidentielles restent bien prot√©g√©es. Vous y trouverez aussi la sp√©cification technique t√©l√©chargeable sous format YAML afin de pouvoir acc√©l√©rer le d√©veloppement de vos outils d'interfa√ßage avec API&nbsp;Particulier.

                  #### √âl√©ments constitutifs de la requ√™te HTTP d'API&nbsp;Particulier

                  Chaque URL de requ√™te est sp√©cifi√©e dans le [Swagger](<%= developers_openapi_path %>){:target="_blank_"}.

                  #### Constatez votre premi√®re trace d‚Äôappel depuis le compte utilisateur

                  Une fois que vous avez fait un premier appel, celui-ci est **r√©pertori√©** dans votre [compte utilisateur](<%= authorization_requests_path %>){:target="_blank"}, dans la page d√©taill√©e de l'habilitation concern√©e, au niveau du jeton. Un lien vous permet d'acc√©der aux statistiques.

              - title: Configurer le logiciel m√©tier
                anchor: 'configurer-le-logiciel-m√©tier'
                content: |+
                  Documentation en construction&nbsp;üöß

              - title: Monitorer la disponibilit√© des API
                anchor: 'monitorer-la-disponibilit√©-des-api'
                content: |+
                  D√®s l'int√©gration d'API Particulier, prenez un temps pour vous assurer d'√™tre inform√© de la disponibilit√© de nos API&nbsp;:
                  - Ajoutez des routes de pings pour automatiser la surveillance des API par vous-m√™me. Pour en savoir plus, consulter la rubrique [_"surveiller l'√©tat des fournisseurs"_](<%= developers_path(anchor: 'surveillance-etat-fournisseurs') %>) ;
                  - abonnez-vous aux incidents et op√©rations de maintenance directement depuis notre [page de statut](https://status.entreprise.api.gouv.fr/){:target="_blank"}.

          - anchor: 'incidents-et-maintenances'
            title: Incidents et maintenances&nbsp;üöß
            subsections:
              - title: Que faire en cas de rupture de service ?
                anchor: 'que-faire-en-cas-de-rupture-de-service-'
                content: |+
                  Le service ne r√©pond plus ? consultez [cette rubrique de notre FAQ](<%= api_particulier_faq_index_path(anchor: 'le-service-ne-repond-plus-que-faire') %>){:target="_blank"}.
              - title: √ätre inform√© des ruptures de service
                anchor: '√™tre-inform√©-des-ruptures-de-service'
                content: |+
                  1. **Abonnez-vous aux notifications** par e-mail depuis [notre page de statut](https://status.particulier.api.gouv.fr/subscribe/email){:target="_blank"}.

                  2. **Ajoutez des routes de pings pour automatiser la surveillance** des API par vous-m√™me. Plut√¥t que de consulter ponctuellement notre page de statuts, vous pouvez vous branchez directement √† nos routes afin d'avoir un suivi encore plus pr√©cis. Pour en savoir plus, consulter la rubrique [surveiller l'√©tat des fournisseurs](<%= developers_path(anchor: 'surveillance-etat-fournisseurs') %>) ;

                  3. Si vous rencontrez un probl√®me et avez besoin d'√©changer avec nous en transmettant des donn√©es sensibles, utilisez le [formulaire de transfert d'informations s√©curis√©es (D√©marches simplifi√©es)](https://www.demarches-simplifiees.fr/commencer/api-particulier-transfert-securise-d-informations){:target="_blank"}. 
                  Si vous n'avez pas de r√©ponse sous 72h, n'h√©sitez pas √† nous envoyer votre num√©ro de demande D√©marches simplifi√©es √† l'adresse [api-particulier@api.gouv.fr](mailto:api-particulier@api.gouv.fr).

          - anchor: 'gestion-du-cache'
            title: Gestion du cache
            subsections:
              - title: Fonctionnement du cache
                anchor: 'fonctionnement-du-cache'
                content: |+
                  L'impl√©mentation du cache suit les normes standard sur l'ensemble des apis via l'utilisation headers sp√©cifiques : 

                  1. Dans toutes les r√©ponses de nos APIs, l'ent√™te vous transmet des informations sur le cache&nbsp;:

                  {:.fr-table}
                  | Champs du header    |   Signification    |     Format           |
                  |:------------------------------|:------------------|:------------:|
                  | `X-Response-Cached` |Indique si la r√©ponse a √©t√© cach√©. | Bool√©en|
                  | `X-Cache-Expires-in` | Nombre de secondes avant que le cache n'expire. Si le cache est vide, cet ent√™te est vide (mais pr√©sent). La validit√© du cache est variable selon l'API, veuillez vous r√©f√©rer √† l'API en question pour plus de d√©tail | Nombre |

                  2. Il est possible de forcer un appel sans utiliser le cache

                  {:.fr-table}
                  | Champs du header    |   Signification    |     Format           |
                  |:------------------------------|:------------------|
                  | `Cache-Control` | Si cette valeur est fix√©e √† "no-cache", le syst√®me de cache est alors ignor√© et la donn√©e est directement r√©cup√©r√©e depuis le fournisseur de donn√©es. |
              - title: Est ce que toutes les APIs ont du cache ?
                anchor: est-ce-que-toutes-les-api-ont-du-cache
                content: |+
                  Non, l'activation et la dur√©e du cache est fonction de l'API et d√©pend de la fr√©quence de rafraichissement de la donn√©es chez le fournisseur. Pour plus d'informations, veuillez vous r√©f√©rer √† la documentation de l'API en question.

          - anchor: 'prolongation-du-jwt'
            title: Prolongation de la dur√©e de vie du JWT&nbsp;üîë
            content: >-
              Pour comprendre comment prolonger votre jeton, consultez [cette rubrique de notre FAQ](<%= faq_index_path(anchor: 'comment-prolonger-mon-jeton-arrivant-a-expiration') %>){:target="_blank"}
          - anchor: 'guide-migration-v3'
            title: üîÑ Guide de migration V.3
            content: >-
              Pour les utilistaeurs de la V.2 de l'API Particulier, [ce guide de migration V.3](/blog/migration-api-particulier-v3) permet de comprendre les changements propos√©s par cette nouvelle version.



