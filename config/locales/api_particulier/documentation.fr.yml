---
fr:
  api_particulier:
    documentation_pages:
      developers:
        title: Espace d√©veloppeurs&nbsp;üõ†
        sections:
          - anchor: 'prerequis-techniques'
            title: Pr√©requis techniques
            content: |+
              Voici la liste des **fondamentaux techniques √† mettre en place pour le bon fonctionnement de l‚ÄôAPI&nbsp;Particulier**&nbsp;:

              - ‚òëÔ∏è √ätre en mesure de g√©rer le protocole HTTPS ;
              - ‚òëÔ∏è Avoir une version de langage r√©cente. Si vous utilisez Java, une version >= 1.8 est n√©cessaire (pour la gestion des certificats de +1024 bit, du TLS 1.2 minimum et des suites cryptographiques - ciphers) ;
              - ‚òëÔ∏è S‚Äôassurer que nos Autorit√©s de Certification (AC) pour les certificats SSL sont autoris√©es par vos syst√®mes ;
              - ‚òëÔ∏è L'API&nbsp;Particulier est uniquement accessible par internet. Si vous avez un pare-feu, il faut donc pr√©voir de whitelister l'adresse IP du service API&nbsp;Particulier ;
              - ‚òëÔ∏è Il est interdit d'interroger l'API&nbsp;Particulier depuis un site web en front-end, car le jeton d'acc√®s serait alors divulgu√©. Il vous faut donc interroger nos API depuis une application en back-end. Nous n'autoriserons pas le CORS (CORS - Cross Origin Ressource Sharing) ;
              - ‚òëÔ∏è Pr√©voir non seulement les co√ªts de d√©veloppement mais √©galement les co√ªts de maintenance ;
              - ‚òëÔ∏è √ätre en capacit√© de g√©rer les mises √† jour de l'API&nbsp;Particulier.

              <br>

              {:.fr-highlight}
              > üí° Pour mieux comprendre l'API&nbsp;Particulier avant de demander un acc√®s, **vous pouvez utiliser [notre environnement de test](<%= developers_path(anchor: 'tester-api-preproduction') %>)**.

          - anchor: 'specifications-generales'
            title: Sp√©cifications g√©n√©rales&nbsp;üéõ
            subsections:
              - title: Respecter la volum√©trie
                anchor: 'respecter-la-volum√©trie'
                content: |+
                  #### Les plafonds

                  Les limites de volum√©trie sur API&nbsp;Particulier se d√©composent en deux r√®gles principales&nbsp;:&nbsp;

                  - **Un plafond g√©n√©ral par IP de 1000 requ√™tes/minute** ;

                  - **Une volum√©trie par jeton&nbsp;:** 20 requ√™tes/secondes.

                  #### Informations volum√©trie dans le header

                  ##### Pour toutes les r√©ponses&nbsp;:

                  Dans toutes les r√©ponses de nos API, le header vous transmet des informations sur la volum√©trie&nbsp;:

                  {:.fr-table}
                  | Champs du header    |   Signification    |     Format           |
                  |:------------------------------|:------------------|:------------:|
                  | `RateLimit-Limit` |La **limite** concernant l'endpoint appel√©, soit le nombre de requ√™te/minute. | Nombre|
                  | `RateLimit-Remaining` |Le **nombre d'appels restants** durant la p√©riode courante d'une minute. | Nombre |
                  | `RateLimit-Reset` |La **fin de la p√©riode** courante. | Timestamp |

                  {:.fr-highlight.fr-highlight--example}
                  > **Exemple&nbsp;:**
                  > Consid√©rons un endpoint ayant une limite de 50 appels /minute.
                  > Vous fa√Ætes un premier appel √† 10h00 pile, et effectuez un second appel 20 secondes plus tard, puis un troisi√®me 10 secondes plus tard, vous aurez les valeurs suivantes :
                  > - `RateLimit-Limit` : 50 ;
                  > - `RateLimit-Remaining` : 47 (50 moins les 3 appels effectu√©s) ;
                  > - `RateLimit-Reset` : [*Timestamp correspondant au jour pr√©sent √† 10h01*]. Le premier appel initialise le compteur (√† 10h00 pile), la p√©riode se termine 1min plus tard.
                  >
                  > Vous pouvez donc jusqu'√† 10h01 pile effectuer 47 appels, le compteur sera r√©initialis√© √† 50 √† ce moment-l√†.

                  ##### En cas de d√©passement :

                  Si vous d√©passez le nombre d'appels autoris√©s (`RateLimit-Remaining = 0`), le serveur r√©pondra avec le `status 429` sur tous les appels suivants dans la m√™me p√©riode.

                  Le header associ√© √† ce code erreur `429` sera accompagn√©&nbsp;:&nbsp;
                  - des trois champs pr√©c√©dents ;
                  - d'un champ suppl√©mentaire indiquant le temps √† attendre avant de pouvoir effectuer des nouveaux appels.

                  {:.fr-table}
                  | Champs du header    |   Signification    |     Format           |
                  |:------------------------------|:------------------|:------------:|
                  | `RateLimit-Limit` |La **limite** concernant l'endpoint appel√©, soit le nombre de requ√™te/minute. | Nombre|
                  | `RateLimit-Remaining` |Le **nombre d'appels restants** durant la p√©riode courante d'une minute. | Nombre |
                  | `RateLimit-Reset` |La **fin de la p√©riode** courante. | Timestamp |
                  | *Uniquement pour le header associ√© au code erreur 429* <br> `Retry-after`| **D√©compte du nombre de secondes restantes** avant la prochaine p√©riode | Secondes |

                  Vous pouvez donc **utiliser les champs du header pour optimiser votre consommation de l'API&nbsp;Particulier**.

                  #### R√®gles de bannissement en cas de surconsommation

                  En cas de non prise en compte des codes erreurs `429` ou en cas de d√©passement de la limite de volum√©trie globale, **votre IP sera temporairement bannie de nos serveurs pour une dur√©e fixe et non r√©vocable de 12h**. Si vous avez plusieurs jetons, tous seront donc bloqu√©s pendant ce laps de temps.

                  Les appels depuis une IP bannie ne renvoient pas de codes HTTP, le serveur ne r√©pond tout simplement pas.

                  {:.fr-highlight}
                  > ‚ÑπÔ∏è Au bout de ces 12 heures, vos acc√®s sont automatiquement r√©tablis ; **il est donc inutile d'√©crire au support**.

                  Nous vous invitons √† prendre les mesures n√©cessaires car le d√©passement intervient g√©n√©ralement chez nos utilisateurs lorsque leur programme n'a pas √©t√© correctement configur√©.

                  Pour les appels de traitement de masse, il est souhaitable que vous fassiez vos **batchs automatiques la nuit ou durant les heures creuses** afin de ne pas affecter la qualit√© du service pour le reste des usagers.

              - title: Configurer vos timeout
                anchor: 'configurer-vos-timeout'
                content: |+
                  Le timeout est le temps d'attente maximal de r√©ponse √† une requ√™te. Il vous permet de ne pas immobiliser votre logiciel en le laissant bloqu√© sur un appel sans r√©ponse.

                  De fa√ßon g√©n√©rale, nous vous recommandons un timeout de **5 secondes**.

                  De m√™me, pour ne pas immobiliser nos serveurs, nous attendons les r√©ponses de nos fournisseurs un maximum de 10 secondes avant de vous les retransmettre. Si ce d√©lai d‚Äôattente est d√©pass√© un code erreur HTTP `504` vous sera renvoy√©.

              - title: Autoriser nos Autorit√©s de Certifications
                anchor: 'autoriser-nos-autorit√©s-de-certifications'
                content: |+
                  API&nbsp;Particulier utilise [DHIMYOTIS](https://www.dhimyotis.com/) comme organisme de d√©livrance de ses certificats SSL principaux ainsi que [Let's Encrypt](https://letsencrypt.org/) pour certains services secondaires.

                  Il est conseill√© d'ajouter ces Autorit√©s de Certifications (AC) √† votre base de confiance si vous en avez une. Une solution id√©ale est d'utiliser un paquet d'autorit√©s mises √† jour automatiquement ([Mozilla par exemple](https://wiki.mozilla.org/CA/Included_Certificates))

                  API&nbsp;Particulier utilise des certificats multi-domaines ; c'es-√†-dire avec un "nom courant" (_common name - CN_) et plusieurs "noms alternatifs du sujet" (_subject alternatives names - SAN_), **soyez certains que vos outils fonctionnent correctement avec**.

              - title: G√©rer les erreurs - codes HTTPS
                anchor: 'g√©rer-les-erreurs---codes-https'
                content: |+
                  #### Un code standard HTTPS pour cat√©goriser le statut de l'appel

                  Toutes les r√©ponse de l‚ÄôAPI&nbsp;Particulier sont envoy√©es avec un code HTTPS. **Ces codes permettent de se renseigner sur le statut de l‚Äôappel**, et sont harmonis√©s pour l'ensemble des API quelque soit le fournisseur de donn√©es.
                  Pour en savoir plus sur les codes HTTPS, cet article de [Wikipedia](https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP){:target="_blank"} constitue une bonne base explicative.

                  ##### En cas de succ√®s, le code HTTP commence par 2 :

                  {:.fr-table}
                  | Code HTTPS                                       |      Signification                 |
                  |--------------------------------------------------|------------------------------------|
                  |`200` | **Tout va bien.**|

                  ##### En cas d‚Äô√©chec, si l‚Äôerreur vient de votre c√¥t√©, le code HTTP commence par 4 :

                  {:.fr-table}
                  | Code HTTP                       |      Signification                     |
                  |---------------------------------|----------------------------------------|
                  |`400` | **Mauvaise requ√™te** ‚Äì La syntaxe de votre requ√™te est erron√©e: les param√®tres ne sont pas valides.|
                  |`401` | **Non autoris√©** ‚Äì Votre token est invalide ou manquant.|
                  |`403` | **Interdit** ‚Äì Le serveur a compris votre requ√™te mais refuse de l‚Äôex√©cuter car votre jeton ne vous donne pas acc√®s √† cette ressource.|
                  |`404` | **Non trouv√©** ‚Äì La ressource demand√©e n'a pas √©t√© trouv√©e. |


                  ###### En cas d‚Äô√©chec, si l‚Äôerreur provient d‚ÄôAPI&nbsp;Particulier ou bien des fournisseurs de donn√©es, le code HTTP commence par 5 :

                  {:.fr-table}
                  | Code HTTP                        |      Signification                     |
                  |----------------------------------|----------------------------------------|
                  |`500` | **Erreur interne √† API&nbsp;Particulier** ‚Äì Une erreur interne du serveur d‚ÄôAPI&nbsp;Particulier est survenue.
                  |`503` | **Service non disponible** ‚Äì Le service est temporairement indisponible ou en maintenance.
                  |`504` | **Interm√©diaire hors d√©lai** ‚Äì Le(s) producteur(s) de donn√©es ont mis trop de temps √† r√©pondre. Notre temps d‚Äôattente, nous permettant de ne pas immobiliser le serveur sur un appel sans r√©ponse, est fix√© √† 10 secondes et a √©t√© d√©pass√©.|

                  Retrouvez tous les codes erreurs pour chaque endpoint dans [notre swagger, partie "Response samples"](<%= developers_openapi_path %>){:target="_blank"}.
                  La liste des codes sp√©cifiques √† chaque endpoint y est disponible.

              - title: Retrouver les droits d'un jeton
                anchor: 'retrouver-les-droits-dun-jeton'
                content: |+
                  Pour conna√Ætre **la liste des APIs auxquelles vous avez le droit** avec votre jeton d'acc√®s, vous pouvez le v√©rifier avec l'API `/api/introspect`.

                  Si vous g√©rez les tokens pour vos utilisateurs, vous pouvez aussi utiliser cette API pour v√©rifier les droits associ√©s √† leurs tokens.

                  {:.fr-h5}
                  #### La requ√™te HTTP :

                  ```
                  https://particulier.api.gouv.fr/api/introspect?token=LeTokenATester
                  ```

                  Le param√®tre d'appel √† renseigner est le token dont vous souhaitez conna√Ætre les droits.

                  > **Exemple de r√©ponse JSON :**
                  >```
                  >{
                  >  "_id": "48ed8e98-33e4-4b05-88fe-f933d1b421c4",
                  >  "name": null,
                  >  "scopes": [
                  >    "cnous_statut_boursier",
                  >    [...]
                  >    "cnaf_adresse"
                  >  ]
                  >}
                  > ```

                  La r√©ponse JSON renvoie la liste des API et champs autoris√©es. Retrouvez-leurs sp√©cifications techniques dans le [Swagger](<%= developers_openapi_path %>){:target="_blank_"}.

          - anchor: 'kit-de-mise-en-production'
            title: Kit de mise en production&nbsp;üöÄ
            subsections:
              - title: Tester l'API en pr√©production
                anchor: 'tester-api-preproduction'
                content: |+
                  L'API&nbsp;Particulier est **testable avec un jeton accessible √† tous depuis notre environnement de staging**. Ce bac √† sable retourne des donn√©es fictives.

                  Pour utiliser l'environnement de test, plusieurs moyens sont possibles :
                  * **Utilisez l'interface disponible depuis [API.gouv](https://api.gouv.fr/documentation/api-particulier){:target="_blank"}** :
                      1. Copiez le jeton de test disponible dans les premiers paragraphes de la page.
                      2. S√©lectionnez _"https://staging.particulier.api.gouv.fr - Environnement de staging"_ dans le menu d√©roulant situ√© un peu plus bas du jeton de test, √† gauche.
                      3. Cliquez sur le bouton √† droite _"Authorize"_, et entrez le jeton de test dans le champ _"Value"_ de la modale qui s'est ouverte ; validez en cliquant sur _"Authorize"_. L'environnement de test est configur√©, fermez la modale.
                      4. Pour terminer, pour chacune des API, un bouton _"Try it out"_ vous permet de pr√©remplir les param√®tres d'appel avec diff√©rents exemples. Appuyez sur _"Execute"_ pour obtenir les diff√©rentes r√©ponses possibles.

                  * **Utilisez un logiciel de type _Postman_ √† partir du fichier OpenAPI :**
                      1. T√©l√©chargez le fichier OpenAPI de l'API&nbsp;Particulier depuis la [page de swagger](<%= developers_openapi_path %>), avec le bouton "Download" situ√© en d√©but de page.
                      2. Importer ce fichier dans un logiciel de test de type _Postman_.
                      3. Configurez votre environnement avec l'url de l'environnement de staging `https://staging.particulier.api.gouv.fr`.
                      API&nbsp;Particulier ne recommande pas un logiciel plus qu'un autre, de nombreux tutoriels sont disponibles sur internet.

              - title: R√©cup√©rer le jeton JWT&nbsp;üîë
                anchor: 'r√©cup√©rer-le-jeton-jwt'
                content: |+
                  Seule la personne ayant fait la demande d'habilitation a acc√®s au token, au travers du [compte utilisateur API&nbsp;Particulier](<%= api_particulier_user_profile_path %>){:target="_blank"}.

                  - _Si vous avez r√©alis√© la demande d'habilitation_, vous pouvez **r√©cup√©rer vos tokens ou jetons d'acc√®s directement depuis votre [compte](<%= api_particulier_user_profile_path %>){:target="_blank"}**.

              - title: Faire sa premi√®re requ√™te
                anchor: 'faire-sa-premi√®re-requ√™te'
                content: |+
                  #### Utiliser l'environnement de production - _Swagger_

                  Apr√®s avoir r√©cup√©r√© votre jeton, vous pouvez faire un premier appel de test.

                  Utilisez l'[environnement de production document√© (_Swagger_)](https://api.gouv.fr/documentation/api-particulier}){:target="_blank"}, disponible sur api.gouv.fr.
                  Il permet, √† l'aide d'un token d'authentification valide üîë, d'effectuer directement depuis le navigateur des tests de l'API. Les donn√©es confidentielles restent bien prot√©g√©es. Vous y trouverez aussi la sp√©cification technique t√©l√©chargeable sous format YAML afin de pouvoir acc√©l√©rer le d√©veloppement de vos outils d'interfa√ßage avec API&nbsp;Particulier.

                  #### √âl√©ments constitutifs de la requ√™te HTTP d'API&nbsp;Particulier

                  Chaque URL de requ√™te est sp√©cifi√©e dans le [Swagger](<%= developers_openapi_path %>){:target="_blank_"},
